/*! For license information please see main.js.LICENSE.txt */
!function(){"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){const e={PLAYER_HEALTH:50,PLAYER_SPEED:5.5,PLAYER_WIDTH:64,PLAYER_HEIGHT:64,SPRITE_WALK:"assets/game/player/walk.png",SPRITE_RUN:"assets/game/player/run.png",SPRITE_HURT:"assets/game/player/hurt.png",SPRITE_DEAD:"assets/game/player/dead.png",GAME_FRAME:0,SPRITE_FRAME:0,SPRITE_X:32,SPRITE_Y:32,SPRITE_POS_X:100,SPRITE_POS_Y:440,SOUND_HURT:"assets/music/effects/destroy.wav"},n=document.getElementById("bg-music"),s=new Audio(e.SOUND_HURT);s.volume=.1;class i{constructor(t,n){this.dimensions=t,this.health=e.PLAYER_HEALTH,this.spriteAnim={walk:e.SPRITE_WALK,run:e.SPRITE_RUN,attack:e.SPRITE_ATTACK,hurt:e.SPRITE_HURT,dead:e.SPRITE_DEAD},this.playerImg=new Image,this.playerImg.src=e.SPRITE_WALK,this.fps=n,this.frameTimer=0}walk(){this.playerImg.src=this.spriteAnim.walk,this.running=!1}run(){this.playerImg.src=this.spriteAnim.run,this.running=!0}hurt(){e.GAME_FRAME=1,n.muted||s.play(),this.playerImg.src=this.spriteAnim.hurt,this.health-=10,this.hurts=!0}dead(){e.GAME_FRAME=0,this.playerImg.src=this.spriteAnim.dead}draw(t,n){this.outOfHealth()&&this.position>=4||(this.hurts&&this.position>=4?(this.hurts=!1,this.running?this.run():this.walk()):this.frameTimer>this.fps?(this.position=Math.floor(e.GAME_FRAME/e.PLAYER_SPEED)%5,e.SPRITE_FRAME=e.SPRITE_X*this.position,e.GAME_FRAME++,this.frameTimer=0):this.frameTimer+=n),t.drawImage(this.playerImg,e.SPRITE_FRAME,0,e.SPRITE_X,e.SPRITE_Y,e.SPRITE_POS_X,e.SPRITE_POS_Y,e.PLAYER_WIDTH,e.PLAYER_HEIGHT)}outOfHealth(){return this.health<=0}bounds(){return{left:e.SPRITE_POS_X,right:e.SPRITE_POS_X+e.PLAYER_WIDTH,top:e.SPRITE_POS_Y,bottom:e.SPRITE_POS_Y+e.PLAYER_HEIGHT}}collidesWith(t,e){return t.right>e.left}}const r=["Mike is the best","Abbey is the best","Paulo is the best","I like sushi","destroy me","don't kill me","let me live T_T","yum lunch","let it rip","slime slime slime","what is love?","don't hurt me","Ew!","do or do not","roses are red","coding is cool","find the One Piece","drill pierce heavens!","ask salmon else","slime slime slime","krusty krab pizza","UwU","plus ultra","me hokage!","yer a wizard","slimes not limes","dedicate your heart","time stops for no one","yum yum","rise and slime","slime this","is purple blue?","are you a bully?","hike and brunch","don't mock me","slimes be sliming","it be like that","drink water","hello world","i am goo-tiful","stay gooey","you goo-fy","slime feelin' good","blue over pink","SQUISHY","squish this","WOW BUNNY","8==D","1, 2, 3","whatever","Who am I?","what am I?","I'm just filler","WOOHOO","snails have slime","I wanna digivolve.","smile","the very best","baby, don't hurt me","shake it off","keep calm","champagne","vanilla extract","Rose Water","2 + 2 = 5","brave new world","splendid slimes","gobble","come along with me","Come here.","crying in slime mart","wash your hands","boba is life","ball is life","octopus","puff puff","my back hurts","booty everywhere","bewbs","reincarnated as a","what in the isekai","a bus hit me","hark the herald","slimageddon","my slime academia","slimer moon","Slimeball Z","O_O"],o={ENEMY_SPEED:1,STAGGER_FRAME:10,ENEMY_WIDTH:64,ENEMY_HEIGHT:64,GAME_FRAME:0,SPRITE_FRAME:0,SPRITE_X:32,SPRITE_Y:25,SPRITE_POS_X:1140,SPRITE_POS_Y:445};class a{constructor(t,e,n,s,i,a){this.dimensions=t,this.speed=Math.floor(e*o.ENEMY_SPEED+o.ENEMY_SPEED),this.pos_x=Math.floor(o.SPRITE_POS_X+100*n),this.pos_y=0,this.stagger_frame=o.STAGGER_FRAME-this.speed,this.enemyImg=new Image,this.enemyImg.src="assets/game/enemy/slime.png",this.words=r[Math.floor(Math.random()*r.length)],this.words_y=o.SPRITE_POS_Y-150*Math.random(),this.score=this.words.length,this.destroyed=!1,this.checkWord(s),this.checkWordPosition(i),this.fps=a,this.maxFrame=60,this.frameTimer=0}checkWordPosition(t){if(void 0!==t)for(;t.includes(this.words_y);)this.words_y+=10}checkWord(t){if(void 0!==t)for(;t.includes(this.words);)this.words=r[Math.floor(Math.random()*r.length)]}draw(t,e){this.destroyed||(t.beginPath(),t.fillStyle="white",t.roundRect(this.pos_x-this.words.length-9,this.words_y-28,10*this.words.length+10,22,[10]),t.fill(),t.strokeStyle="gray",t.stroke(),t.fillStyle="black",t.font="24px VT323",t.fillText(this.words,this.pos_x-this.words.length,this.words_y-10)),this.move(t,e)}move(t,e){this.destroyed&&this.position>=6||(this.position=Math.floor(o.GAME_FRAME/this.stagger_frame)%7,o.SPRITE_FRAME=o.SPRITE_X*this.position,t.drawImage(this.enemyImg,o.SPRITE_FRAME,this.pos_y,o.SPRITE_X,o.SPRITE_Y,this.pos_x,o.SPRITE_POS_Y,o.ENEMY_WIDTH,o.ENEMY_HEIGHT)),this.frameTimer<this.fps?(o.GAME_FRAME++,this.pos_x-=this.speed/2,this.frameTimer=0):this.frameTimer+=e}destroy(){this.pos_y=2*o.SPRITE_Y,o.GAME_FRAME=1,this.destroyed=!0}bounds(){return{left:this.pos_x,right:this.pos_x+o.ENEMY_WIDTH,top:o.SPRITE_POS_Y,bottom:o.SPRITE_POS_Y+o.ENEMY_HEIGHT}}}const h={GAME_SPEED:.7,GAME_FRAME:0,SPEED_MODS:[0,.5,.7,.9],WIDTH:1152,HEIGHT:576};class c{constructor(t,e){this.ctx=t,this.bg=["assets/game/background/nature_2/1.png","assets/game/background/nature_2/2.png","assets/game/background/nature_5/3.png","assets/game/background/nature_5/4.png"],this.layers=[],this.fps=e;let n=0;this.bg.forEach((t=>{const e=new Image;e.src=t,this.layers.push(new u(e,this.ctx,h.SPEED_MODS[n],h.GAME_SPEED,this.fps)),n++}))}changeSpeed(t){this.layers.forEach((e=>{e.changeSpeed(t)}))}draw(t,e){this.layers.forEach((t=>{t.update(e),t.draw()}))}}class u{constructor(t,e,n,s,i){this.x=0,this.y=0,this.ctx=e,this.width=h.WIDTH,this.height=h.HEIGHT,this.img=t,this.speedMod=n,this.speed=s*this.speedMod,this.draw=this.draw.bind(this),this.frameTimer=0,this.fps=i}update(t){this.frameTimer>this.fps?(this.x=h.GAME_FRAME*this.speed%this.width,this.frameTimer=0,h.GAME_FRAME--):this.frameTimer+=t}changeSpeed(t){this.speed=t}draw(){this.ctx.drawImage(this.img,this.x,this.y,this.width,this.height),this.ctx.drawImage(this.img,this.x+this.width,this.y,this.width,this.height)}}const l=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++s)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},d={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const i=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,h=a?t[e+2]:0,c=i>>2,u=(3&i)<<4|o>>4;let l=(15&o)<<2|h>>6,d=63&h;a||(d=64,r||(l=64)),s.push(n[c],n[u],n[l],n[d])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(l(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(r>>10)),e[s++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],r=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==r||null==o||null==a)throw new f;const h=i<<2|r>>4;if(s.push(h),64!==o){const t=r<<4&240|o>>2;if(s.push(t),64!==a){const t=o<<6&192|a;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class f extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p=function(t){return function(t){const e=l(t);return d.encodeByteArray(e,!0)}(t).replace(/\./g,"")},m=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t="MISSING_ENV_VAR".__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return d.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},g=()=>{var t;return null===(t=m())||void 0===t?void 0:t.config};class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}class v extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w.prototype.create)}}class w{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],r=i?function(t,e){return t.replace(_,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${r} (${s}).`;return new v(s,o,n)}}const _=/\{\$([^}]+)}/g;function E(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const n=t[i],r=e[i];if(T(n)&&T(r)){if(!E(n,r))return!1}else if(n!==r)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function T(t){return null!==t&&"object"==typeof t}function b(t){return t&&t._delegate?t._delegate:t}class I{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const S="[DEFAULT]";class A{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new y;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:S})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=S){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=S){return this.instances.has(t)}getOptions(t=S){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(s);return s}onInit(t,e){var n;const s=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&t(r,s),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===S?void 0:s),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var s;return n||null}normalizeInstanceIdentifier(t=S){return this.component?this.component.multipleInstances?t:S:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class C{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new A(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const D=[];var R,N;(N=R||(R={}))[N.DEBUG=0]="DEBUG",N[N.VERBOSE=1]="VERBOSE",N[N.INFO=2]="INFO",N[N.WARN=3]="WARN",N[N.ERROR=4]="ERROR",N[N.SILENT=5]="SILENT";const k={debug:R.DEBUG,verbose:R.VERBOSE,info:R.INFO,warn:R.WARN,error:R.ERROR,silent:R.SILENT},M=R.INFO,x={[R.DEBUG]:"log",[R.VERBOSE]:"log",[R.INFO]:"info",[R.WARN]:"warn",[R.ERROR]:"error"},O=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),i=x[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${s}]  ${t.name}:`,...n)};class L{constructor(t){this.name=t,this._logLevel=M,this._logHandler=O,this._userLogHandler=null,D.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in R))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?k[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,R.DEBUG,...t),this._logHandler(this,R.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,R.VERBOSE,...t),this._logHandler(this,R.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,R.INFO,...t),this._logHandler(this,R.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,R.WARN,...t),this._logHandler(this,R.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,R.ERROR,...t),this._logHandler(this,R.ERROR,...t)}}const P=(t,e)=>e.some((e=>t instanceof e));let V,F;const U=new WeakMap,B=new WeakMap,j=new WeakMap,q=new WeakMap,H=new WeakMap;let $={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return B.get(t);if("objectStoreNames"===e)return t.objectStoreNames||j.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return z(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function G(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(K(this),t),z(U.get(this))}:function(...t){return z(e.apply(K(this),t))}:function(t,...n){const s=e.call(K(this),t,...n);return j.set(s,t.sort?t.sort():[t]),z(s)}:(t instanceof IDBTransaction&&function(t){if(B.has(t))return;const e=new Promise(((e,n)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",r),t.removeEventListener("abort",r)},i=()=>{e(),s()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",r),t.addEventListener("abort",r)}));B.set(t,e)}(t),P(t,V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,$):t);var e}function z(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",r)},i=()=>{e(z(t.result)),s()},r=()=>{n(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&U.set(e,t)})).catch((()=>{})),H.set(e,t),e}(t);if(q.has(t))return q.get(t);const e=G(t);return e!==t&&(q.set(t,e),H.set(e,t)),e}const K=t=>H.get(t),W=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],Y=new Map;function X(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Y.get(e))return Y.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=Q.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!W.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,i?"readwrite":"readonly");let o=r.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&r.done]))[0]};return Y.set(e,r),r}var J;J=$,$={...J,get:(t,e,n)=>X(t,e)||J.get(t,e,n),has:(t,e)=>!!X(t,e)||J.has(t,e)};class Z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const tt="@firebase/app",et="0.10.11",nt=new L("@firebase/app"),st="[DEFAULT]",it={[tt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},rt=new Map,ot=new Map,at=new Map;function ht(t,e){try{t.container.addComponent(e)}catch(n){nt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ct(t){const e=t.name;if(at.has(e))return nt.debug(`There were multiple attempts to register component ${e}.`),!1;at.set(e,t);for(const e of rt.values())ht(e,t);for(const e of ot.values())ht(e,t);return!0}const ut=new w("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class lt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new I("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ut.create("app-deleted",{appName:this._name})}}function dt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const s=Object.assign({name:st,automaticDataCollectionEnabled:!1},e),i=s.name;if("string"!=typeof i||!i)throw ut.create("bad-app-name",{appName:String(i)});if(n||(n=g()),!n)throw ut.create("no-options");const r=rt.get(i);if(r){if(E(n,r.options)&&E(s,r.config))return r;throw ut.create("duplicate-app",{appName:i})}const o=new C(i);for(const t of at.values())o.addComponent(t);const a=new lt(n,s,o);return rt.set(i,a),a}function ft(t,e,n){var s;let i=null!==(s=it[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${i}" with version "${e}":`];return r&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void nt.warn(t.join(" "))}ct(new I(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const pt="firebase-heartbeat-database",mt=1,gt="firebase-heartbeat-store";let yt=null;function vt(){return yt||(yt=function(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=z(o);return s&&o.addEventListener("upgradeneeded",(t=>{s(z(o.result),t.oldVersion,t.newVersion,z(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(pt,mt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(gt)}catch(t){console.warn(t)}}}).catch((t=>{throw ut.create("idb-open",{originalErrorMessage:t.message})}))),yt}async function wt(t,e){try{const n=(await vt()).transaction(gt,"readwrite"),s=n.objectStore(gt);await s.put(e,_t(t)),await n.done}catch(t){if(t instanceof v)nt.warn(t.message);else{const e=ut.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});nt.warn(e.message)}}}function _t(t){return`${t.name}!${t.options.appId}`}class Et{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new bt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Tt();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some((t=>t.date===s)))return;return this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(t){nt.warn(t)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Tt(),{heartbeatsToSend:n,unsentEntries:s}=function(t,e=1024){const n=[];let s=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),It(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),It(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),i=p(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return nt.warn(t),""}}}function Tt(){return(new Date).toISOString().substring(0,10)}class bt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await vt()).transaction(gt),n=await e.objectStore(gt).get(_t(t));return await e.done,n}catch(t){if(t instanceof v)nt.warn(t.message);else{const e=ut.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});nt.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return wt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return wt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function It(t){return p(JSON.stringify({version:2,heartbeats:t})).length}ct(new I("platform-logger",(t=>new Z(t)),"PRIVATE")),ct(new I("heartbeat",(t=>new Et(t)),"PRIVATE")),ft(tt,et,""),ft(tt,et,"esm2017"),ft("fire-js",""),ft("firebase","10.13.2","app");var St,At,Ct="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Dt={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var s=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)s[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)s[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var r=t.g[3],o=e+(r^n&(i^r))+s[0]+3614090360&4294967295;o=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=n+(o<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(i^r))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(i^r))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(i^r))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^r&(n^i))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r&(n^i))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r&(n^i))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r&(n^i))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^r)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^r)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^r)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^r)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~r))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(r|~n))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~e))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~r))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(r|~n))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~e))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~r))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(r|~n))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~e))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(e=n+((o=e+(i^(n|~r))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=r+((o=i+(e^(r|~n))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+r&4294967295}function s(t,e){this.h=e;for(var n=[],s=!0,i=t.length-1;0<=i;i--){var r=0|t[i];s&&r==e||(n[i]=r,s=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var s=e-this.blockSize,i=this.B,r=this.h,o=0;o<e;){if(0==r)for(;o<=s;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[r++]=t.charCodeAt(o++),r==this.blockSize){n(this,i),r=0;break}}else for(;o<e;)if(i[r++]=t[o++],r==this.blockSize){n(this,i),r=0;break}}this.h=r,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var s=0;32>s;s+=8)t[n++]=this.g[e]>>>s&255;return t};var i={};function r(t){return-128<=t&&128>t?function(t,e){var n=i;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new s([0|t],0>t?-1:0)}(t)}(t):new s([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new s(e,0)}var a=r(0),h=r(1),c=r(16777216);function u(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function l(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new s(n,~t.h).add(h)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function m(t,e){this.g=t,this.h=e}function g(t,e){if(u(e))throw Error("division by zero");if(u(t))return new m(a,a);if(l(t))return e=g(d(t),e),new m(d(e.g),d(e.h));if(l(e))return e=g(t,d(e)),new m(d(e.g),e.h);if(30<t.g.length){if(l(t)||l(e))throw Error("slowDivide_ only works with positive integers.");for(var n=h,s=e;0>=s.l(t);)n=y(n),s=y(s);var i=v(n,1),r=v(s,1);for(s=v(s,2),n=v(n,2);!u(s);){var c=r.add(s);0>=c.l(t)&&(i=i.add(n),r=c),s=v(s,1),n=v(n,1)}return e=f(t,i.j(e)),new m(i,e)}for(i=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),c=(r=o(n)).j(e);l(c)||0<c.l(t);)c=(r=o(n-=s)).j(e);u(r)&&(r=h),i=i.add(r),t=f(t,c)}return new m(i,t)}function y(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new s(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,r=[],o=0;o<i;o++)r[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new s(r,t.h)}(t=s.prototype).m=function(){if(l(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var s=this.i(n);t+=(0<=s?s:4294967296+s)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(u(this))return"0";if(l(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,s="";;){var i=g(n,e).g,r=((0<(n=f(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(u(n=i))return r+s;for(;6>r.length;)r="0"+r;s=r+s}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return l(t=f(this,t))?-1:u(t)?0:1},t.abs=function(){return l(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,r=0;r<=e;r++){var o=i+(65535&this.i(r))+(65535&t.i(r)),a=(o>>>16)+(this.i(r)>>>16)+(t.i(r)>>>16);i=a>>>16,o&=65535,a&=65535,n[r]=a<<16|o}return new s(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(u(this)||u(t))return a;if(l(this))return l(t)?d(this).j(d(t)):d(d(this).j(t));if(l(t))return d(this.j(d(t)));if(0>this.l(c)&&0>t.l(c))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<t.g.length;r++){var h=this.i(i)>>>16,f=65535&this.i(i),m=t.i(r)>>>16,g=65535&t.i(r);n[2*i+2*r]+=f*g,p(n,2*i+2*r),n[2*i+2*r+1]+=h*g,p(n,2*i+2*r+1),n[2*i+2*r+1]+=f*m,p(n,2*i+2*r+1),n[2*i+2*r+2]+=h*m,p(n,2*i+2*r+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new s(n,0)},t.A=function(t){return g(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new s(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new s(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new s(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,At=Dt.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=o,s.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=o(Math.pow(n,8)),i=a,r=0;r<e.length;r+=8){var h=Math.min(8,e.length-r),c=parseInt(e.substring(r,r+h),n);8>h?(h=o(Math.pow(n,h)),i=i.j(h).add(o(c))):i=(i=i.j(s)).add(o(c))}return i},St=Dt.Integer=s}).apply(void 0!==Ct?Ct:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Rt,Nt,kt,Mt,xt,Ot,Lt,Pt,Vt,Ft="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ut={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ft&&Ft];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,s){if(s)t:{var i=n;t=t.split(".");for(var r=0;r<t.length-1;r++){var o=t[r];if(!(o in i))break t;i=i[o]}(s=s(r=i[t=t[t.length-1]]))!=r&&null!=s&&e(i,t,{configurable:!0,writable:!0,value:s})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,s=!1,i={next:function(){if(!s&&n<t.length){var i=n++;return{value:e(0,t[i]),done:!1}}return s=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t,e){return e}))}}));var s=s||{},i=this||self;function r(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function h(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function c(t,e,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:h).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(r(n)){const e=t.length||0,s=n.length||0;t.length=e+s;for(let i=0;i<s;i++)t[e+i]=n[i]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function m(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function g(t){return g[" "](t),t}g[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<_.length;e++)n=_[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function T(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function b(t){i.setTimeout((()=>{throw t}),0)}function I(){var t=R;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var S=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new A),(t=>t.reset()));class A{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let C,D=!1,R=new class{constructor(){this.h=this.g=null}add(t,e){const n=S.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const t=i.Promise.resolve(void 0);C=()=>{t.then(k)}};var k=()=>{for(var t;t=I();){try{t.h.call(t.g)}catch(t){b(t)}var e=S;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}D=!1};function M(){this.s=this.s,this.C=this.C}function x(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}M.prototype.s=!1,M.prototype.ma=function(){this.s||(this.s=!0,this.N())},M.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},x.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function L(t,e){if(x.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{g(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:P[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&L.aa.h.call(this)}}l(L,x);var P={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var V="closure_listenable_"+(1e6*Math.random()|0),F=0;function U(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ha=i,this.key=++F,this.da=this.fa=!1}function B(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function j(t){this.src=t,this.g={},this.h=0}function q(t,e){var n=e.type;if(n in t.g){var s,i=t.g[n],r=Array.prototype.indexOf.call(i,e,void 0);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(B(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function H(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.da&&r.listener==e&&r.capture==!!n&&r.ha==s)return i}return-1}j.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=H(t,e,s,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new U(e,this.src,r,!!s,i)).fa=n,t.push(e)),e};var $="closure_lm_"+(1e6*Math.random()|0),G={};function z(t,e,n,s,i){if(s&&s.once)return W(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)z(t,e[r],n,s,i);return null}return n=et(n),t&&t[V]?t.K(e,n,o(s)?!!s.capture:!!s,i):K(t,e,n,!1,s,i)}function K(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,h=Z(t);if(h||(t[$]=h=new j(t)),(n=h.add(e,n,s,a,r)).proxy)return n;if(s=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)O||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(X(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function W(t,e,n,s,i){if(Array.isArray(e)){for(var r=0;r<e.length;r++)W(t,e[r],n,s,i);return null}return n=et(n),t&&t[V]?t.L(e,n,o(s)?!!s.capture:!!s,i):K(t,e,n,!0,s,i)}function Q(t,e,n,s,i){if(Array.isArray(e))for(var r=0;r<e.length;r++)Q(t,e[r],n,s,i);else s=o(s)?!!s.capture:!!s,n=et(n),t&&t[V]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=H(r=t.g[e],n,s,i))&&(B(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=H(e,n,s,i)),(n=-1<t?e[t]:null)&&Y(n))}function Y(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[V])q(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(X(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Z(e))?(q(n,t),0==n.h&&(n.src=null,e[$]=null)):B(t)}}}function X(t){return t in G?G[t]:G[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new L(e,this);var n=t.listener,s=t.ha||t.src;t.fa&&Y(t),t=n.call(s,e)}return t}function Z(t){return(t=t[$])instanceof j?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){M.call(this),this.i=new j(this),this.M=this,this.F=null}function st(t,e){var n,s=t.F;if(s)for(n=[];s;s=s.F)n.push(s);if(t=t.M,s=e.type||e,"string"==typeof e)e=new x(e,t);else if(e instanceof x)e.target=e.target||t;else{var i=e;E(e=new x(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];i=it(o,s,!0,e)&&i}if(i=it(o=e.g=t,s,!0,e)&&i,i=it(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=it(o=e.g=n[r],s,!1,e)&&i}function it(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.da&&o.capture==n){var a=o.listener,h=o.ha||o.src;o.fa&&q(t.i,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}function rt(t,e,n){if("function"==typeof t)n&&(t=c(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function ot(t){t.g=rt((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(nt,M),nt.prototype[V]=!0,nt.prototype.removeEventListener=function(t,e,n,s){Q(this,t,e,n,s)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)B(n[s]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},nt.prototype.L=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};class at extends M{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ht(t){M.call(this),this.h=t,this.g={}}l(ht,M);var ct=[];function ut(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Y(t)}),t),t.g={}}ht.prototype.N=function(){ht.aa.N.call(this),ut(this)},ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lt=i.JSON.stringify,dt=i.JSON.parse,ft=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function pt(){}function mt(t){return t.h||(t.h=t.i())}function gt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){x.call(this,"d")}function wt(){x.call(this,"c")}l(vt,x),l(wt,x);var _t={},Et=null;function Tt(){return Et=Et||new nt}function bt(t){x.call(this,_t.La,t)}function It(t){const e=Tt();st(e,new bt(e))}function St(t,e){x.call(this,_t.STAT_EVENT,t),this.stat=e}function At(t){const e=Tt();st(e,new St(e,t))}function Ct(t,e){x.call(this,_t.Ma,t),this.size=e}function Dt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){t()}),e)}function Bt(){this.g=!0}function jt(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return lt(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}_t.La="serverreachability",l(bt,x),_t.STAT_EVENT="statevent",l(St,x),_t.Ma="timingevent",l(Ct,x),Bt.prototype.xa=function(){this.g=!1},Bt.prototype.info=function(){};var qt,Ht={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$t={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Gt(){}function zt(t,e,n,s){this.j=t,this.i=e,this.l=n,this.R=s||1,this.U=new ht(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Kt}function Kt(){this.i=null,this.g="",this.h=!1}l(Gt,pt),Gt.prototype.g=function(){return new XMLHttpRequest},Gt.prototype.i=function(){return{}},qt=new Gt;var Wt={},Qt={};function Yt(t,e,n){t.L=1,t.v=Te(ye(e)),t.m=n,t.P=!0,Xt(t,null)}function Xt(t,e){t.F=Date.now(),te(t),t.A=ye(t.v);var n=t.A,s=t.R;Array.isArray(s)||(s=[String(s)]),Pe(n.i,"t",s),t.C=0,n=t.j.J,t.h=new Kt,t.g=In(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(c(t.Y,t,t.g),t.O)),e=t.U,n=t.g,s=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(ct[0]=i.toString()),i=ct);for(var r=0;r<i.length;r++){var o=z(n,i[r],s||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),It(),function(t,e,n,s,i,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var c=a[h].split("=");if(1<c.length){var u=c[0];c=c[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function Jt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function Zt(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?Qt:(n=Number(e.substring(n,s)),isNaN(n)?Wt:(s+=1)+n>e.length?Qt:(e=e.slice(s,s+n),t.C=s+n,e))}function te(t){t.S=Date.now()+t.I,ee(t,t.I)}function ee(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Dt(c(t.ba,t),e)}function ne(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function se(t){0==t.j.G||t.J||wn(t.j,t)}function ie(t){ne(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,ut(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function re(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||ue(n.h,t)))if(!t.K&&ue(n.h,t)&&3==n.G){try{var s=n.Da.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;vn(n),hn(n)}mn(n),At(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Dt(c(n.Za,n),6e3));if(1>=ce(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else En(n,11)}else if((t.K||n.g==t)&&vn(n),!p(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const e=c[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=c[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(s=1.5*u,n.L=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=s.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(le(r,r.h),r.h=null))}if(s.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.ya=t,Ee(s.I,s.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((s=n).qa=bn(s,s.J?s.ia:null,s.W),o.K){de(s.h,o);var a=o,h=s.L;h&&(a.I=h),a.B&&(ne(a),te(a)),s.g=o}else pn(s);0<n.i.length&&un(n)}else"stop"!=c[0]&&"close"!=c[0]||En(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?En(n,7):an(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}It()}catch(t){}}zt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==nn(t)?e.j():this.Y(t)},zt.prototype.Y=function(t){try{if(t==this.g)t:{const d=nn(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||sn(this.g)))){this.J||4!=d||7==e||It(),ne(this);var n=this.g.Z();this.X=n;e:if(Jt(this)){var s=sn(this.g);t="";var r=s.length,o=4==nn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ie(this),se(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:!(o&&e==r-1)});s.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,s,i,r,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var h,c=this.g;if((h=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(h)){var u=h;break e}}u=null}if(!(n=u)){this.o=!1,this.s=3,At(12),ie(this),se(this);break t}jt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,re(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=Zt(this,a),t==Qt){4==d&&(this.s=4,At(14),n=!1),jt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Wt){this.s=4,At(15),jt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}jt(this.i,this.l,t,null),re(this,t)}if(Jt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,At(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var l=this.j;l.g==this&&l.ba&&!l.M&&(l.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),gn(l),l.M=!0,At(11))}}else jt(this.i,this.l,a,"[Invalid Chunked Response]"),ie(this),se(this)}else jt(this.i,this.l,a,null),re(this,a);4==d&&ie(this),this.o&&!this.J&&(4==d?wn(this.j,this):(this.o=!1,te(this)))}else(function(t){const e={};t=(t.g&&2<=nn(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<t.length;s++){if(p(t[s]))continue;var n=T(t[s]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=e[i]||[];e[i]=r,r.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,At(12)):(this.s=0,At(13)),ie(this),se(this)}}}catch(t){}},zt.prototype.cancel=function(){this.J=!0,ie(this)},zt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(It(),At(17)),ie(this),this.s=2,se(this)):ee(this,this.S-t)};var oe=class{constructor(t,e){this.g=t,this.map=e}};function ae(t){this.l=t||10,t=i.PerformanceNavigationTiming?0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function he(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ce(t){return t.h?1:t.g?t.g.size:0}function ue(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function le(t,e){t.g?t.g.add(e):t.h=e}function de(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function fe(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function pe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(r(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(r(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}(t),s=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(r(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),i=s.length,o=0;o<i;o++)e.call(void 0,s[o],n&&n[o],t)}ae.prototype.cancel=function(){if(this.i=fe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var me=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ge(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof ge){this.h=t.h,ve(this,t.j),this.o=t.o,this.g=t.g,we(this,t.s),this.l=t.l;var e=t.i,n=new Me;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),_e(this,n),this.m=t.m}else t&&(e=String(t).match(me))?(this.h=!1,ve(this,e[1]||"",!0),this.o=be(e[2]||""),this.g=be(e[3]||"",!0),we(this,e[4]),this.l=be(e[5]||"",!0),_e(this,e[6]||"",!0),this.m=be(e[7]||"")):(this.h=!1,this.i=new Me(null,this.h))}function ye(t){return new ge(t)}function ve(t,e,n){t.j=n?be(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function we(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function _e(t,e,n){e instanceof Me?(t.i=e,function(t,e){e&&!t.j&&(xe(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Oe(this,e),Pe(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Ie(e,Ne)),t.i=new Me(e,t.h))}function Ee(t,e,n){t.i.set(e,n)}function Te(t){return Ee(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function be(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ie(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Se),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Se(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ge.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ie(e,Ce,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Ie(e,Ce,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ie(n,"/"==n.charAt(0)?Re:De,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",Ie(n,ke)),t.join("")};var Ae,Ce=/[#\/\?@]/g,De=/[#\?:]/g,Re=/[#\?]/g,Ne=/[#\?@]/g,ke=/#/g;function Me(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function xe(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Oe(t,e){xe(t),e=Ve(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Le(t,e){return xe(t),e=Ve(t,e),t.g.has(e)}function Pe(t,e,n){Oe(t,e),0<n.length&&(t.i=null,t.g.set(Ve(t,e),d(n)),t.h+=n.length)}function Ve(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Fe(t,e,n,s,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),s(n)}catch(t){}}function Ue(){this.g=new ft}function Be(t,e,n){const s=n||"";try{pe(t,(function(t,n){let i=t;o(t)&&(i=lt(t)),e.push(s+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function je(t){this.l=t.Ub||null,this.j=t.eb||!1}function qe(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function He(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function $e(t){t.readyState=4,t.l=null,t.j=null,t.v=null,Ge(t)}function Ge(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ze(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Ke(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=ze(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ee(t,e,n))}function We(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Me.prototype).add=function(t,e){xe(this),this.i=null,t=Ve(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){xe(this),this.g.forEach((function(n,s){n.forEach((function(n){t.call(e,n,s,this)}),this)}),this)},t.na=function(){xe(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const i=t[s];for(let t=0;t<i.length;t++)n.push(e[s])}return n},t.V=function(t){xe(this);let e=[];if("string"==typeof t)Le(this,t)&&(e=e.concat(this.g.get(Ve(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return xe(this),this.i=null,Le(this,t=Ve(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const r=encodeURIComponent(String(s)),o=this.V(s);for(s=0;s<o.length;s++){var i=r;""!==o[s]&&(i+="="+encodeURIComponent(String(o[s]))),t.push(i)}}return this.i=t.join("&")},l(je,pt),je.prototype.g=function(){return new qe(this.l,this.j)},je.prototype.i=(Ae={},function(){return Ae}),l(qe,nt),(t=qe.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,Ge(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$e(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ge(this)),this.g&&(this.readyState=3,Ge(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;He(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?$e(this):Ge(this),3==this.readyState&&He(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,$e(this))},t.Qa=function(t){this.g&&(this.response=t,$e(this))},t.ga=function(){this.g&&$e(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(qe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(We,nt);var Qe=/^https?$/i,Ye=["POST","PUT"];function Xe(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Je(t),tn(t)}function Je(t){t.A||(t.A=!0,st(t,"complete"),st(t,"error"))}function Ze(t){if(t.h&&void 0!==s&&(!t.v[1]||4!=nn(t)||2!=t.Z()))if(t.u&&4==nn(t))rt(t.Ea,0,t);else if(st(t,"readystatechange"),4==nn(t)){t.h=!1;try{const s=t.Z();t:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===s){var o=String(t.D).match(me)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),r=!Qe.test(o?o.toLowerCase():"")}n=r}if(n)st(t,"complete"),st(t,"success");else{t.m=6;try{var a=2<nn(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",Je(t)}}finally{tn(t)}}}function tn(t,e){if(t.g){en(t);const n=t.g,s=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||st(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function en(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function nn(t){return t.g?t.g.readyState:0}function sn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function on(t){this.Aa=0,this.i=[],this.j=new Bt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,t),this.cb=rn("retryDelaySeedMs",1e4,t),this.Wa=rn("forwardChannelMaxRetries",2,t),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new ae(t&&t.concurrentRequestLimit),this.Da=new Ue,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function an(t){if(cn(t),3==t.G){var e=t.U++,n=ye(t.I);if(Ee(n,"SID",t.K),Ee(n,"RID",e),Ee(n,"TYPE","terminate"),dn(t,n),(e=new zt(t,t.j,e)).L=2,e.v=Te(ye(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=In(e.j,null),e.g.ea(e.v)),e.F=Date.now(),te(e)}Tn(t)}function hn(t){t.g&&(gn(t),t.g.cancel(),t.g=null)}function cn(t){hn(t),t.u&&(i.clearTimeout(t.u),t.u=null),vn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&i.clearTimeout(t.s),t.s=null)}function un(t){if(!he(t.h)&&!t.s){t.s=!0;var e=t.Ga;C||N(),D||(C(),D=!0),R.add(e,t),t.B=0}}function ln(t,e){var n;n=e?e.l:t.U++;const s=ye(t.I);Ee(s,"SID",t.K),Ee(s,"RID",n),Ee(s,"AID",t.T),dn(t,s),t.m&&t.o&&Ke(s,t.m,t.o),n=new zt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=fn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),le(t.h,n),Yt(n,s,e)}function dn(t,e){t.H&&v(t.H,(function(t,n){Ee(e,n,t)})),t.l&&pe({},(function(t,n){Ee(e,n,t)}))}function fn(t,e,n){n=Math.min(t.i.length,n);var s=t.l?c(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),r=!1;else try{Be(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(r){s=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,s}function pn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;C||N(),D||(C(),D=!0),R.add(e,t),t.v=0}}function mn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=Dt(c(t.Fa,t),_n(t,t.v)),t.v++,0))}function gn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function yn(t){t.g=new zt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=ye(t.qa);Ee(e,"RID","rpc"),Ee(e,"SID",t.K),Ee(e,"AID",t.T),Ee(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&Ee(e,"TO",t.ja),Ee(e,"TYPE","xmlhttp"),dn(t,e),t.m&&t.o&&Ke(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=Te(ye(e)),n.m=null,n.P=!0,Xt(n,t)}function vn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function wn(t,e){var n=null;if(t.g==e){vn(t),gn(t),t.g=null;var s=2}else{if(!ue(t.h,e))return;n=e.D,de(t.h,e),s=1}if(0!=t.G)if(e.o)if(1==s){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;st(s=Tt(),new Ct(s,n)),un(t)}else pn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==s&&function(t,e){return!(ce(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=Dt(c(t.Ga,t,e),_n(t,t.B)),t.B++,0)))}(t,e)||2==s&&mn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:En(t,5);break;case 4:En(t,10);break;case 3:En(t,6);break;default:En(t,2)}}function _n(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function En(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.fb,t),s=t.Xa;const e=!s;s=new ge(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ve(s,"https"),Te(s),e?function(t,e){const n=new Bt;if(i.Image){const s=new Image;s.onload=u(Fe,n,"TestLoadImage: loaded",!0,e,s),s.onerror=u(Fe,n,"TestLoadImage: error",!1,e,s),s.onabort=u(Fe,n,"TestLoadImage: abort",!1,e,s),s.ontimeout=u(Fe,n,"TestLoadImage: timeout",!1,e,s),i.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(s.toString(),n):function(t,e){new Bt;const n=new AbortController,s=setTimeout((()=>{n.abort(),Fe(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(s),t.ok?Fe(0,0,!0,e):Fe(0,0,!1,e)})).catch((()=>{clearTimeout(s),Fe(0,0,!1,e)}))}(s.toString(),n)}else At(2);t.G=0,t.l&&t.l.sa(e),Tn(t),cn(t)}function Tn(t){if(t.G=0,t.ka=[],t.l){const e=fe(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function bn(t,e,n){var s=n instanceof ge?ye(n):new ge(n);if(""!=s.g)e&&(s.g=e+"."+s.g),we(s,s.s);else{var r=i.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var o=new ge(null);s&&ve(o,s),e&&(o.g=e),r&&we(o,r),n&&(o.l=n),s=o}return n=t.D,e=t.ya,n&&e&&Ee(s,n,e),Ee(s,"VER",t.la),dn(t,s),s}function In(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new We(new je({eb:n})):new We(t.pa)).Ha(t.J),e}function Sn(){}function An(){}function Cn(t,e){nt.call(this),this.g=new on(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nn(this)}function Dn(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Rn(){wt.call(this),this.status=1}function Nn(t){this.g=t}(t=We.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qt.g(),this.v=this.o?mt(this.o):mt(qt),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Xe(this,t)}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const t of s.keys())n.set(t,s.get(t))}s=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ye,e,void 0))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{en(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Xe(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,st(this,"complete"),st(this,"abort"),tn(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tn(this,!0)),We.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ze(this):this.bb())},t.bb=function(){Ze(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=on.prototype).la=8,t.G=1,t.connect=function(t,e,n,s){At(0),this.W=t,this.H=e||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.I=bn(this,null,this.W),un(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new zt(this,this.j,t);let r=this.o;if(this.S&&(r?(r=w(r),E(r,this.S)):r=this.S),null!==this.m||this.O||(i.H=r,r=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=fn(this,i,e),Ee(n=ye(this.I),"RID",t),Ee(n,"CVER",22),this.D&&Ee(n,"X-HTTP-Session-Id",this.D),dn(this,n),r&&(this.O?e="headers="+encodeURIComponent(String(ze(r)))+"&"+e:this.m&&Ke(n,this.m,r)),le(this.h,i),this.Ua&&Ee(n,"TYPE","init"),this.P?(Ee(n,"$req",e),Ee(n,"SID","null"),i.T=!0,Yt(i,n,null)):Yt(i,n,e),this.G=2}}else 3==this.G&&(t?ln(this,t):0==this.i.length||he(this.h)||ln(this))},t.Fa=function(){if(this.u=null,yn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Dt(c(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,At(10),hn(this),yn(this))},t.Za=function(){null!=this.C&&(this.C=null,hn(this),mn(this),At(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),At(2)):(this.j.info("Failed to ping google.com"),At(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Sn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},An.prototype.g=function(t,e){return new Cn(t,e)},l(Cn,nt),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){an(this.g)},Cn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=lt(t),t=n);e.i.push(new oe(e.Ya++,t)),3==e.G&&un(e)},Cn.prototype.N=function(){this.g.l=null,delete this.j,an(this.g),delete this.g,Cn.aa.N.call(this)},l(Dn,vt),l(Rn,wt),l(Nn,Sn),Nn.prototype.ua=function(){st(this.g,"a")},Nn.prototype.ta=function(t){st(this.g,new Dn(t))},Nn.prototype.sa=function(t){st(this.g,new Rn)},Nn.prototype.ra=function(){st(this.g,"b")},An.prototype.createWebChannel=An.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,Vt=Ut.createWebChannelTransport=function(){return new An},Pt=Ut.getStatEventTarget=function(){return Tt()},Lt=Ut.Event=_t,Ot=Ut.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ht.NO_ERROR=0,Ht.TIMEOUT=8,Ht.HTTP_ERROR=6,xt=Ut.ErrorCode=Ht,$t.COMPLETE="complete",Mt=Ut.EventType=$t,gt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,kt=Ut.WebChannel=gt,Nt=Ut.FetchXmlHttpFactory=je,We.prototype.listenOnce=We.prototype.L,We.prototype.getLastError=We.prototype.Ka,We.prototype.getLastErrorCode=We.prototype.Ba,We.prototype.getStatus=We.prototype.Z,We.prototype.getResponseJson=We.prototype.Oa,We.prototype.getResponseText=We.prototype.oa,We.prototype.send=We.prototype.ea,We.prototype.setWithCredentials=We.prototype.Ha,Rt=Ut.XhrIo=We}).apply(void 0!==Ft?Ft:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Bt="@firebase/firestore";class jt{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}jt.UNAUTHENTICATED=new jt(null),jt.GOOGLE_CREDENTIALS=new jt("google-credentials-uid"),jt.FIRST_PARTY=new jt("first-party-uid"),jt.MOCK_USER=new jt("mock-user");let qt="10.13.2";const Ht=new L("@firebase/firestore");function $t(){return Ht.logLevel}function Gt(t,...e){if(Ht.logLevel<=R.DEBUG){const n=e.map(Wt);Ht.debug(`Firestore (${qt}): ${t}`,...n)}}function zt(t,...e){if(Ht.logLevel<=R.ERROR){const n=e.map(Wt);Ht.error(`Firestore (${qt}): ${t}`,...n)}}function Kt(t,...e){if(Ht.logLevel<=R.WARN){const n=e.map(Wt);Ht.warn(`Firestore (${qt}): ${t}`,...n)}}function Wt(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Qt(t="Unexpected state"){const e=`FIRESTORE (${qt}) INTERNAL ASSERTION FAILED: `+t;throw zt(e),new Error(e)}function Yt(t,e){t||Qt()}function Xt(t,e){return t}const Jt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Zt extends v{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class te{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class ee{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ne{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(jt.UNAUTHENTICATED)))}shutdown(){}}class se{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class ie{constructor(t){this.t=t,this.currentUser=jt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new te;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new te,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{Gt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Gt("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new te)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Gt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Yt("string"==typeof e.accessToken),new ee(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Yt(null===t||"string"==typeof t),new jt(t)}}class re{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=jt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class oe{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new re(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(jt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ae{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class he{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Gt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Gt("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{Gt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?s(t):Gt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Yt("string"==typeof t.token),this.R=t.token,new ae(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ce(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ue{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ce(40);for(let s=0;s<n.length;++s)e.length<20&&n[s]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return e}}function le(t,e){return t<e?-1:t>e?1:0}function de(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}class fe{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Zt(Jt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Zt(Jt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Zt(Jt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Zt(Jt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return fe.fromMillis(Date.now())}static fromDate(t){return fe.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new fe(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?le(this.nanoseconds,t.nanoseconds):le(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class pe{constructor(t){this.timestamp=t}static fromTimestamp(t){return new pe(t)}static min(){return new pe(new fe(0,0))}static max(){return new pe(new fe(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class me{constructor(t,e,n){void 0===e?e=0:e>t.length&&Qt(),void 0===n?n=t.length-e:n>t.length-e&&Qt(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===me.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof me?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ge extends me{construct(t,e,n){return new ge(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Zt(Jt.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ge(e)}static emptyPath(){return new ge([])}}const ye=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ve extends me{construct(t,e,n){return new ve(t,e,n)}static isValidIdentifier(t){return ye.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ve.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ve(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Zt(Jt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Zt(Jt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Zt(Jt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Zt(Jt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ve(e)}static emptyPath(){return new ve([])}}class we{constructor(t){this.path=t}static fromPath(t){return new we(ge.fromString(t))}static fromName(t){return new we(ge.fromString(t).popFirst(5))}static empty(){return new we(ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ge.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ge.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new we(new ge(t.slice()))}}function _e(t){return new Ee(t.readTime,t.key,-1)}class Ee{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Ee(pe.min(),we.empty(),-1)}static max(){return new Ee(pe.max(),we.empty(),-1)}}function Te(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=we.comparator(t.documentKey,e.documentKey),0!==n?n:le(t.largestBatchId,e.largestBatchId))}const be="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ie{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Se(t){if(t.code!==Jt.FAILED_PRECONDITION||t.message!==be)throw t;Gt("LocalStore","Unexpectedly lost primary lease")}class Ae{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Qt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ae(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ae?e:Ae.resolve(e)}catch(t){return Ae.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ae.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ae.reject(e)}static resolve(t){return new Ae(((e,n)=>{e(t)}))}static reject(t){return new Ae(((e,n)=>{n(t)}))}static waitFor(t){return new Ae(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=Ae.resolve(!1);for(const n of t)e=e.next((t=>t?Ae.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new Ae(((n,s)=>{const i=t.length,r=new Array(i);let o=0;for(let a=0;a<i;a++){const h=a;e(t[h]).next((t=>{r[h]=t,++o,o===i&&n(r)}),(t=>s(t)))}}))}static doWhile(t,e){return new Ae(((n,s)=>{const i=()=>{!0===t()?e().next((()=>{i()}),s):n()};i()}))}}function Ce(t){return"IndexedDbTransactionError"===t.name}class De{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function Re(t){return null==t}function Ne(t){return 0===t&&1/t==-1/0}De.oe=-1;function ke(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Me(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function xe(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Oe{constructor(t,e){this.comparator=t,this.root=e||Pe.EMPTY}insert(t,e){return new Oe(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Pe.BLACK,null,null))}remove(t){return new Oe(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Pe.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Le(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Le(this.root,t,this.comparator,!1)}getReverseIterator(){return new Le(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Le(this.root,t,this.comparator,!0)}}class Le{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Pe{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:Pe.RED,this.left=null!=s?s:Pe.EMPTY,this.right=null!=i?i:Pe.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Pe(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Pe.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Pe.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Pe.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Pe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qt();if(this.right.isRed())throw Qt();const t=this.left.check();if(t!==this.right.check())throw Qt();return t+(this.isRed()?0:1)}}Pe.EMPTY=null,Pe.RED=!0,Pe.BLACK=!1,Pe.EMPTY=new class{constructor(){this.size=0}get key(){throw Qt()}get value(){throw Qt()}get color(){throw Qt()}get left(){throw Qt()}get right(){throw Qt()}copy(t,e,n,s,i){return this}insert(t,e,n){return new Pe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ve{constructor(t){this.comparator=t,this.data=new Oe(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Fe(this.data.getIterator())}getIteratorFrom(t){return new Fe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ve))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ve(this.comparator);return e.data=t,e}}class Fe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ue{constructor(t){this.fields=t,t.sort(ve.comparator)}static empty(){return new Ue([])}unionWith(t){let e=new Ve(ve.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ue(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return de(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Be extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class je{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Be("Invalid base64 string: "+t):t}}(t);return new je(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new je(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return le(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}je.EMPTY_BYTE_STRING=new je("");const qe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function He(t){if(Yt(!!t),"string"==typeof t){let e=0;const n=qe.exec(t);if(Yt(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:$e(t.seconds),nanos:$e(t.nanos)}}function $e(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ge(t){return"string"==typeof t?je.fromBase64String(t):je.fromUint8Array(t)}function ze(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ke(t){const e=t.mapValue.fields.__previous_value__;return ze(e)?Ke(e):e}function We(t){const e=He(t.mapValue.fields.__local_write_time__.timestampValue);return new fe(e.seconds,e.nanos)}class Qe{constructor(t,e,n,s,i,r,o,a,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=h}}class Ye{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ye("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ye&&t.projectId===this.projectId&&t.database===this.database}}const Xe={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Je(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ze(t)?4:mn(t)?9007199254740991:fn(t)?10:11:Qt()}function Ze(t,e){if(t===e)return!0;const n=Je(t);if(n!==Je(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return We(t).isEqual(We(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=He(t.timestampValue),s=He(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ge(t.bytesValue).isEqual(Ge(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return $e(t.geoPointValue.latitude)===$e(e.geoPointValue.latitude)&&$e(t.geoPointValue.longitude)===$e(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return $e(t.integerValue)===$e(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=$e(t.doubleValue),s=$e(e.doubleValue);return n===s?Ne(n)===Ne(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return de(t.arrayValue.values||[],e.arrayValue.values||[],Ze);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(ke(n)!==ke(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Ze(n[t],s[t])))return!1;return!0}(t,e);default:return Qt()}}function tn(t,e){return void 0!==(t.values||[]).find((t=>Ze(t,e)))}function en(t,e){if(t===e)return 0;const n=Je(t),s=Je(e);if(n!==s)return le(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return le(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=$e(t.integerValue||t.doubleValue),s=$e(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return nn(t.timestampValue,e.timestampValue);case 4:return nn(We(t),We(e));case 5:return le(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ge(t),s=Ge(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=le(n[t],s[t]);if(0!==e)return e}return le(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=le($e(t.latitude),$e(e.latitude));return 0!==n?n:le($e(t.longitude),$e(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return sn(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,s,i,r;const o=t.fields||{},a=e.fields||{},h=null===(n=o.value)||void 0===n?void 0:n.arrayValue,c=null===(s=a.value)||void 0===s?void 0:s.arrayValue,u=le((null===(i=null==h?void 0:h.values)||void 0===i?void 0:i.length)||0,(null===(r=null==c?void 0:c.values)||void 0===r?void 0:r.length)||0);return 0!==u?u:sn(h,c)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Xe.mapValue&&e===Xe.mapValue)return 0;if(t===Xe.mapValue)return 1;if(e===Xe.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=le(s[t],r[t]);if(0!==e)return e;const o=en(n[s[t]],i[r[t]]);if(0!==o)return o}return le(s.length,r.length)}(t.mapValue,e.mapValue);default:throw Qt()}}function nn(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return le(t,e);const n=He(t),s=He(e),i=le(n.seconds,s.seconds);return 0!==i?i:le(n.nanos,s.nanos)}function sn(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=en(n[t],s[t]);if(e)return e}return le(n.length,s.length)}function rn(t){return on(t)}function on(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=He(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Ge(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return we.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=on(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${on(t.fields[i])}`;return n+"}"}(t.mapValue):Qt()}function an(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function hn(t){return!!t&&"integerValue"in t}function cn(t){return!!t&&"arrayValue"in t}function un(t){return!!t&&"nullValue"in t}function ln(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function dn(t){return!!t&&"mapValue"in t}function fn(t){var e,n;return"__vector__"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pn(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Me(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=pn(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=pn(t.arrayValue.values[n]);return e}return Object.assign({},t)}function mn(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class gn{constructor(t){this.value=t}static empty(){return new gn({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!dn(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=pn(e)}setAll(t){let e=ve.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=pn(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());dn(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ze(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];dn(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Me(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new gn(pn(this.value))}}function yn(t){const e=[];return Me(t.fields,((t,n)=>{const s=new ve([t]);if(dn(n)){const t=yn(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new Ue(e)}class vn{constructor(t,e,n,s,i,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(t){return new vn(t,0,pe.min(),pe.min(),pe.min(),gn.empty(),0)}static newFoundDocument(t,e,n,s){return new vn(t,1,e,pe.min(),n,s,0)}static newNoDocument(t,e){return new vn(t,2,e,pe.min(),pe.min(),gn.empty(),0)}static newUnknownDocument(t,e){return new vn(t,3,e,pe.min(),pe.min(),gn.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(pe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=gn.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=gn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=pe.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof vn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new vn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class wn{constructor(t,e){this.position=t,this.inclusive=e}}function _n(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?we.comparator(we.fromName(o.referenceValue),n.key):en(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function En(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ze(t.position[n],e.position[n]))return!1;return!0}class Tn{constructor(t,e="asc"){this.field=t,this.dir=e}}function bn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class In{}class Sn extends In{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Mn(t,e,n):"array-contains"===e?new Pn(t,n):"in"===e?new Vn(t,n):"not-in"===e?new Fn(t,n):"array-contains-any"===e?new Un(t,n):new Sn(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new xn(t,n):new On(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(en(e,this.value)):null!==e&&Je(this.value)===Je(e)&&this.matchesComparison(en(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Qt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class An extends In{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new An(t,e)}matches(t){return Cn(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Cn(t){return"and"===t.op}function Dn(t){return function(t){for(const e of t.filters)if(e instanceof An)return!1;return!0}(t)&&Cn(t)}function Rn(t){if(t instanceof Sn)return t.field.canonicalString()+t.op.toString()+rn(t.value);if(Dn(t))return t.filters.map((t=>Rn(t))).join(",");{const e=t.filters.map((t=>Rn(t))).join(",");return`${t.op}(${e})`}}function Nn(t,e){return t instanceof Sn?function(t,e){return e instanceof Sn&&t.op===e.op&&t.field.isEqual(e.field)&&Ze(t.value,e.value)}(t,e):t instanceof An?function(t,e){return e instanceof An&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,s)=>t&&Nn(n,e.filters[s])),!0)}(t,e):void Qt()}function kn(t){return t instanceof Sn?function(t){return`${t.field.canonicalString()} ${t.op} ${rn(t.value)}`}(t):t instanceof An?function(t){return t.op.toString()+" {"+t.getFilters().map(kn).join(" ,")+"}"}(t):"Filter"}class Mn extends Sn{constructor(t,e,n){super(t,e,n),this.key=we.fromName(n.referenceValue)}matches(t){const e=we.comparator(t.key,this.key);return this.matchesComparison(e)}}class xn extends Sn{constructor(t,e){super(t,"in",e),this.keys=Ln(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class On extends Sn{constructor(t,e){super(t,"not-in",e),this.keys=Ln(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ln(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>we.fromName(t.referenceValue)))}class Pn extends Sn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return cn(e)&&tn(e.arrayValue,this.value)}}class Vn extends Sn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&tn(this.value.arrayValue,e)}}class Fn extends Sn{constructor(t,e){super(t,"not-in",e)}matches(t){if(tn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!tn(this.value.arrayValue,e)}}class Un extends Sn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!cn(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>tn(this.value.arrayValue,t)))}}class Bn{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.ue=null}}function jn(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Bn(t,e,n,s,i,r,o)}function qn(t){const e=Xt(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Rn(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Re(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>rn(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>rn(t))).join(",")),e.ue=t}return e.ue}function Hn(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!bn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Nn(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!En(t.startAt,e.startAt)&&En(t.endAt,e.endAt)}function $n(t){return we.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Gn{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function zn(t){return new Gn(t)}function Kn(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Wn(t){return null!==t.collectionGroup}function Qn(t){const e=Xt(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",s=function(t){let e=new Ve(ve.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);s.forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Tn(s,n))})),t.has(ve.keyField().canonicalString())||e.ce.push(new Tn(ve.keyField(),n))}return e.ce}function Yn(t){const e=Xt(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return jn(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Tn(t.field,e)}));const n=t.endAt?new wn(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new wn(t.startAt.position,t.startAt.inclusive):null;return jn(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}(e,Qn(t))),e.le}function Xn(t,e){const n=t.filters.concat([e]);return new Gn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Jn(t,e,n){return new Gn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Zn(t,e){return Hn(Yn(t),Yn(e))&&t.limitType===e.limitType}function ts(t){return`${qn(Yn(t))}|lt:${t.limitType}`}function es(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>kn(t))).join(", ")}]`),Re(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>rn(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>rn(t))).join(",")),`Target(${e})`}(Yn(t))}; limitType=${t.limitType})`}function ns(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):we.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Qn(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=_n(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,Qn(t),e)||t.endAt&&!function(t,e,n){const s=_n(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,Qn(t),e))}(t,e)}function ss(t){return(e,n)=>{let s=!1;for(const i of Qn(t)){const t=is(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function is(t,e,n){const s=t.field.isKeyField()?we.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?en(s,i):Qt()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Qt()}}class rs{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Me(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return xe(this.inner)}size(){return this.innerSize}}const os=new Oe(we.comparator);function as(){return os}const hs=new Oe(we.comparator);function cs(...t){let e=hs;for(const n of t)e=e.insert(n.key,n);return e}function us(t){let e=hs;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ls(){return fs()}function ds(){return fs()}function fs(){return new rs((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ps=new Oe(we.comparator),ms=new Ve(we.comparator);function gs(...t){let e=ms;for(const n of t)e=e.add(n);return e}const ys=new Ve(le);function vs(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ne(e)?"-0":e}}function ws(t){return{integerValue:""+t}}function _s(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Ne(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?ws(e):vs(t,e)}class Es{constructor(){this._=void 0}}function Ts(t,e,n){return t instanceof Ss?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&ze(e)&&(e=Ke(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof As?Cs(t,e):t instanceof Ds?Rs(t,e):function(t,e){const n=Is(t,e),s=ks(n)+ks(t.Pe);return hn(n)&&hn(t.Pe)?ws(s):vs(t.serializer,s)}(t,e)}function bs(t,e,n){return t instanceof As?Cs(t,e):t instanceof Ds?Rs(t,e):n}function Is(t,e){return t instanceof Ns?function(t){return hn(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ss extends Es{}class As extends Es{constructor(t){super(),this.elements=t}}function Cs(t,e){const n=Ms(e);for(const e of t.elements)n.some((t=>Ze(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Ds extends Es{constructor(t){super(),this.elements=t}}function Rs(t,e){let n=Ms(e);for(const e of t.elements)n=n.filter((t=>!Ze(t,e)));return{arrayValue:{values:n}}}class Ns extends Es{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function ks(t){return $e(t.integerValue||t.doubleValue)}function Ms(t){return cn(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class xs{constructor(t,e){this.version=t,this.transformResults=e}}class Os{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Os}static exists(t){return new Os(void 0,t)}static updateTime(t){return new Os(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ls(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ps{}function Vs(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Ks(t.key,Os.none()):new qs(t.key,t.data,Os.none());{const n=t.data,s=gn.empty();let i=new Ve(ve.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),i=i.add(t)}return new Hs(t.key,s,new Ue(i.toArray()),Os.none())}}function Fs(t,e,n){t instanceof qs?function(t,e,n){const s=t.value.clone(),i=Gs(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Hs?function(t,e,n){if(!Ls(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Gs(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll($s(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Us(t,e,n,s){return t instanceof qs?function(t,e,n,s){if(!Ls(t.precondition,e))return n;const i=t.value.clone(),r=zs(t.fieldTransforms,s,e);return i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,s):t instanceof Hs?function(t,e,n,s){if(!Ls(t.precondition,e))return n;const i=zs(t.fieldTransforms,s,e),r=e.data;return r.setAll($s(t)),r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return Ls(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Bs(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=Is(s.transform,t||null);null!=i&&(null===n&&(n=gn.empty()),n.set(s.field,i))}return n||null}function js(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&de(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof As&&e instanceof As||t instanceof Ds&&e instanceof Ds?de(t.elements,e.elements,Ze):t instanceof Ns&&e instanceof Ns?Ze(t.Pe,e.Pe):t instanceof Ss&&e instanceof Ss}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class qs extends Ps{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Hs extends Ps{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function $s(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function Gs(t,e,n){const s=new Map;Yt(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,bs(o,a,n[i]))}return s}function zs(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,Ts(t,r,e))}return s}class Ks extends Ps{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ws extends Ps{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qs{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Fs(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Us(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Us(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ds();return this.mutations.forEach((s=>{const i=t.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=e.has(s.key)?null:o;const a=Vs(r,o);null!==a&&n.set(s.key,a),r.isValidDocument()||r.convertToNoDocument(pe.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),gs())}isEqual(t){return this.batchId===t.batchId&&de(this.mutations,t.mutations,((t,e)=>js(t,e)))&&de(this.baseMutations,t.baseMutations,((t,e)=>js(t,e)))}}class Ys{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){Yt(t.mutations.length===n.length);let s=ps;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new Ys(t,e,n,s)}}class Xs{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Js{constructor(t,e){this.count=t,this.unchangedNames=e}}var Zs,ti;function ei(t){if(void 0===t)return zt("GRPC error has no .code"),Jt.UNKNOWN;switch(t){case Zs.OK:return Jt.OK;case Zs.CANCELLED:return Jt.CANCELLED;case Zs.UNKNOWN:return Jt.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return Jt.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return Jt.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return Jt.INTERNAL;case Zs.UNAVAILABLE:return Jt.UNAVAILABLE;case Zs.UNAUTHENTICATED:return Jt.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return Jt.INVALID_ARGUMENT;case Zs.NOT_FOUND:return Jt.NOT_FOUND;case Zs.ALREADY_EXISTS:return Jt.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return Jt.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return Jt.FAILED_PRECONDITION;case Zs.ABORTED:return Jt.ABORTED;case Zs.OUT_OF_RANGE:return Jt.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return Jt.UNIMPLEMENTED;case Zs.DATA_LOSS:return Jt.DATA_LOSS;default:return Qt()}}(ti=Zs||(Zs={}))[ti.OK=0]="OK",ti[ti.CANCELLED=1]="CANCELLED",ti[ti.UNKNOWN=2]="UNKNOWN",ti[ti.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ti[ti.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ti[ti.NOT_FOUND=5]="NOT_FOUND",ti[ti.ALREADY_EXISTS=6]="ALREADY_EXISTS",ti[ti.PERMISSION_DENIED=7]="PERMISSION_DENIED",ti[ti.UNAUTHENTICATED=16]="UNAUTHENTICATED",ti[ti.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ti[ti.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ti[ti.ABORTED=10]="ABORTED",ti[ti.OUT_OF_RANGE=11]="OUT_OF_RANGE",ti[ti.UNIMPLEMENTED=12]="UNIMPLEMENTED",ti[ti.INTERNAL=13]="INTERNAL",ti[ti.UNAVAILABLE=14]="UNAVAILABLE",ti[ti.DATA_LOSS=15]="DATA_LOSS";const ni=new St([4294967295,4294967295],0);function si(t){const e=(new TextEncoder).encode(t),n=new At;return n.update(e),new Uint8Array(n.digest())}function ii(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new St([n,s],0),new St([i,r],0)]}class ri{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new oi(`Invalid padding: ${e}`);if(n<0)throw new oi(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new oi(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new oi(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=St.fromNumber(this.Ie)}Ee(t,e,n){let s=t.add(e.multiply(St.fromNumber(n)));return 1===s.compare(ni)&&(s=new St([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=si(t),[n,s]=ii(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,s,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),r=new ri(i,s,e);return n.forEach((t=>r.insert(t))),r}insert(t){if(0===this.Ie)return;const e=si(t),[n,s]=ii(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,s,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class oi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ai{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,hi.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ai(pe.min(),s,new Oe(le),as(),gs())}}class hi{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new hi(n,e,gs(),gs(),gs())}}class ci{constructor(t,e,n,s){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=s}}class ui{constructor(t,e){this.targetId=t,this.me=e}}class li{constructor(t,e,n=je.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class di{constructor(){this.fe=0,this.ge=mi(),this.pe=je.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=gs(),e=gs(),n=gs();return this.ge.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Qt()}})),new hi(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=mi()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,Yt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class fi{constructor(t){this.Le=t,this.Be=new Map,this.ke=as(),this.qe=pi(),this.Qe=new Oe(le)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:Qt()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.ze(n)&&e(n)}))}He(t){const e=t.targetId,n=t.me.count,s=this.Je(e);if(s){const i=s.target;if($n(i))if(0===n){const t=new we(i.path);this.Ue(e,t,vn.newNoDocument(t,pe.min()))}else Yt(1===n);else{const s=this.Ye(e);if(s!==n){const n=this.Ze(t),i=n?this.Xe(n,t,s):1;if(0!==i){this.je(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let r,o;try{r=Ge(n).toUint8Array()}catch(t){if(t instanceof Be)return Kt("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ri(r,s,i)}catch(t){return Kt(t instanceof oi?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Ie?null:o}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let s=0;return n.forEach((n=>{const i=this.Le.tt(),r=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(r)||(this.Ue(e,n,null),s++)})),s}rt(t){const e=new Map;this.Be.forEach(((n,s)=>{const i=this.Je(s);if(i){if(n.current&&$n(i.target)){const e=new we(i.target.path);null!==this.ke.get(e)||this.it(s,e)||this.Ue(s,e,vn.newNoDocument(e,t))}n.be&&(e.set(s,n.ve()),n.Ce())}}));let n=gs();this.qe.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const s=new ai(t,e,this.Qe,this.ke,n);return this.ke=as(),this.qe=pi(),this.Qe=new Oe(le),s}$e(t,e){if(!this.ze(t))return;const n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;const s=this.Ge(t);this.it(t,e)?s.Fe(e,1):s.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new di,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Ve(le),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||Gt("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new di),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function pi(){return new Oe(we.comparator)}function mi(){return new Oe(we.comparator)}const gi={asc:"ASCENDING",desc:"DESCENDING"},yi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vi={and:"AND",or:"OR"};class wi{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function _i(t,e){return t.useProto3Json||Re(e)?e:{value:e}}function Ei(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ti(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function bi(t,e){return Ei(t,e.toTimestamp())}function Ii(t){return Yt(!!t),pe.fromTimestamp(function(t){const e=He(t);return new fe(e.seconds,e.nanos)}(t))}function Si(t,e){return Ai(t,e).canonicalString()}function Ai(t,e){const n=function(t){return new ge(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ci(t){const e=ge.fromString(t);return Yt(Gi(e)),e}function Di(t,e){return Si(t.databaseId,e.path)}function Ri(t,e){const n=Ci(e);if(n.get(1)!==t.databaseId.projectId)throw new Zt(Jt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Zt(Jt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new we(Mi(n))}function Ni(t,e){return Si(t.databaseId,e)}function ki(t){return new ge(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Mi(t){return Yt(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function xi(t,e,n){return{name:Di(t,e),fields:n.value.mapValue.fields}}function Oi(t,e){return{documents:[Ni(t,e.path)]}}function Li(t,e){const n={structuredQuery:{}},s=e.path;let i;null!==e.collectionGroup?(i=s,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=Ni(t,i);const r=function(t){if(0!==t.length)return Hi(An.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ji(t.field),direction:Fi(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=_i(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:n,parent:i}}function Pi(t){let e=function(t){const e=Ci(t);return 4===e.length?ge.emptyPath():Mi(e)}(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Yt(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=Vi(t);return e instanceof An&&Dn(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Tn(qi(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Re(e)?null:e}(n.limit));let h=null;n.startAt&&(h=function(t){const e=!!t.before,n=t.values||[];return new wn(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new wn(n,e)}(n.endAt)),function(t,e,n,s,i,r,o,a){return new Gn(t,e,n,s,i,r,o,a)}(e,i,o,r,a,"F",h,c)}function Vi(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=qi(t.unaryFilter.field);return Sn.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=qi(t.unaryFilter.field);return Sn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=qi(t.unaryFilter.field);return Sn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=qi(t.unaryFilter.field);return Sn.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Qt()}}(t):void 0!==t.fieldFilter?function(t){return Sn.create(qi(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Qt()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return An.create(t.compositeFilter.filters.map((t=>Vi(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Qt()}}(t.compositeFilter.op))}(t):Qt()}function Fi(t){return gi[t]}function Ui(t){return yi[t]}function Bi(t){return vi[t]}function ji(t){return{fieldPath:t.canonicalString()}}function qi(t){return ve.fromServerFormat(t.fieldPath)}function Hi(t){return t instanceof Sn?function(t){if("=="===t.op){if(ln(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NAN"}};if(un(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ln(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NOT_NAN"}};if(un(t.value))return{unaryFilter:{field:ji(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ji(t.field),op:Ui(t.op),value:t.value}}}(t):t instanceof An?function(t){const e=t.getFilters().map((t=>Hi(t)));return 1===e.length?e[0]:{compositeFilter:{op:Bi(t.op),filters:e}}}(t):Qt()}function $i(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Gi(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class zi{constructor(t,e,n,s,i=pe.min(),r=pe.min(),o=je.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new zi(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new zi(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new zi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new zi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Ki{constructor(t){this.ct=t}}function Wi(t){const e=Pi({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Jn(e,e.limit,"L"):e}class Qi{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At($e(t.integerValue));else if("doubleValue"in t){const n=$e(t.doubleValue);isNaN(n)?this.dt(e,13):(this.dt(e,15),Ne(n)?e.At(0):e.At(n))}else if("timestampValue"in t){let n=t.timestampValue;this.dt(e,20),"string"==typeof n&&(n=He(n)),e.Rt(`${n.seconds||""}`),e.At(n.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(Ge(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.dt(e,45),e.At(n.latitude||0),e.At(n.longitude||0)}else"mapValue"in t?mn(t)?this.dt(e,Number.MAX_SAFE_INTEGER):fn(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):Qt()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){const n=t.fields||{};this.dt(e,55);for(const t of Object.keys(n))this.Vt(t,e),this.Tt(n[t],e)}wt(t,e){var n,s;const i=t.fields||{};this.dt(e,53);const r="value",o=(null===(s=null===(n=i[r].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.dt(e,15),e.At($e(o)),this.Vt(r,e),this.Tt(i[r],e)}bt(t,e){const n=t.values||[];this.dt(e,50);for(const t of n)this.Tt(t,e)}yt(t,e){this.dt(e,37),we.fromName(t).path.forEach((t=>{this.dt(e,60),this.Dt(t,e)}))}dt(t,e){t.At(e)}ft(t){t.At(2)}}Qi.vt=new Qi;class Yi{constructor(){this.un=new Xi}addToCollectionParentIndex(t,e){return this.un.add(e),Ae.resolve()}getCollectionParents(t,e){return Ae.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return Ae.resolve()}deleteFieldIndex(t,e){return Ae.resolve()}deleteAllFieldIndexes(t){return Ae.resolve()}createTargetIndexes(t,e){return Ae.resolve()}getDocumentsMatchingTarget(t,e){return Ae.resolve(null)}getIndexType(t,e){return Ae.resolve(0)}getFieldIndexes(t,e){return Ae.resolve([])}getNextCollectionGroupToUpdate(t){return Ae.resolve(null)}getMinOffset(t,e){return Ae.resolve(Ee.min())}getMinOffsetFromCollectionGroup(t,e){return Ae.resolve(Ee.min())}updateCollectionGroup(t,e,n){return Ae.resolve()}updateIndexEntries(t,e){return Ae.resolve()}}class Xi{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Ve(ge.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Ve(ge.comparator)).toArray()}}new Uint8Array(0);class Ji{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Ji(t,Ji.DEFAULT_COLLECTION_PERCENTILE,Ji.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Ji.DEFAULT_COLLECTION_PERCENTILE=10,Ji.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ji.DEFAULT=new Ji(41943040,Ji.DEFAULT_COLLECTION_PERCENTILE,Ji.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ji.DISABLED=new Ji(-1,0,0);class Zi{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new Zi(0)}static kn(){return new Zi(-1)}}class tr{constructor(){this.changes=new rs((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,vn.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ae.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class er{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class nr{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Us(n.mutation,t,Ue.empty(),fe.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,gs()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=gs()){const s=ls();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=cs();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=ls();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,gs())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let i=as();const r=fs(),o=fs();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof Hs)?i=i.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),Us(o.mutation,e,o.mutation.getFieldMask(),fe.now())):r.set(e.key,Ue.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new er(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=fs();let s=new Oe(((t,e)=>t-e)),i=gs();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Ue.empty();o=i.applyToLocalView(r,o),n.set(t,o);const a=(s.get(i.batchId)||gs()).add(t);s=s.insert(i.batchId,a)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,h=s.value,c=ds();h.forEach((t=>{if(!i.has(t)){const s=Vs(e.get(t),n.get(t));null!==s&&c.set(t,s),i=i.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,c))}return Ae.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,s){return function(t){return we.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Wn(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):Ae.resolve(ls());let o=-1,a=i;return r.next((e=>Ae.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Ae.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,gs()))).next((t=>({batchId:o,changes:us(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new we(e)).next((t=>{let e=cs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let r=cs();return this.indexManager.getCollectionParents(t,i).next((o=>Ae.forEach(o,(o=>{const a=function(t,e){return new Gn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,s).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s)))).next((t=>{i.forEach(((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,vn.newInvalidDocument(s)))}));let n=cs();return t.forEach(((t,s)=>{const r=i.get(t);void 0!==r&&Us(r.mutation,s,Ue.empty(),fe.now()),ns(e,s)&&(n=n.insert(t,s))})),n}))}}class sr{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return Ae.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Ii(t.createTime)}}(e)),Ae.resolve()}getNamedQuery(t,e){return Ae.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(t){return{name:t.name,query:Wi(t.bundledQuery),readTime:Ii(t.readTime)}}(e)),Ae.resolve()}}class ir{constructor(){this.overlays=new Oe(we.comparator),this.Ir=new Map}getOverlay(t,e){return Ae.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ls();return Ae.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.ht(t,e,s)})),Ae.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Ir.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.Ir.delete(n)),Ae.resolve()}getOverlaysForCollection(t,e,n){const s=ls(),i=e.length+1,r=new we(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return Ae.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new Oe(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=ls(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ls(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return Ae.resolve(o)}ht(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Xs(e,n));let i=this.Ir.get(e);void 0===i&&(i=gs(),this.Ir.set(e,i)),this.Ir.set(e,i.add(n.key))}}class rr{constructor(){this.sessionToken=je.EMPTY_BYTE_STRING}getSessionToken(t){return Ae.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Ae.resolve()}}class or{constructor(){this.Tr=new Ve(ar.Er),this.dr=new Ve(ar.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){const n=new ar(t,e);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Vr(new ar(t,e))}mr(t,e){t.forEach((t=>this.removeReference(t,e)))}gr(t){const e=new we(new ge([])),n=new ar(e,t),s=new ar(e,t+1),i=[];return this.dr.forEachInRange([n,s],(t=>{this.Vr(t),i.push(t.key)})),i}pr(){this.Tr.forEach((t=>this.Vr(t)))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const e=new we(new ge([])),n=new ar(e,t),s=new ar(e,t+1);let i=gs();return this.dr.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new ar(t,0),n=this.Tr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ar{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return we.comparator(t.key,e.key)||le(t.wr,e.wr)}static Ar(t,e){return le(t.wr,e.wr)||we.comparator(t.key,e.key)}}class hr{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new Ve(ar.Er)}checkEmpty(t){return Ae.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Qs(i,e,n,s);this.mutationQueue.push(r);for(const e of s)this.br=this.br.add(new ar(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ae.resolve(r)}lookupMutationBatch(t,e){return Ae.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.vr(n),i=s<0?0:s;return Ae.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ae.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(t){return Ae.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ar(e,0),s=new ar(e,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,s],(t=>{const e=this.Dr(t.wr);i.push(e)})),Ae.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ve(le);return e.forEach((t=>{const e=new ar(t,0),s=new ar(t,Number.POSITIVE_INFINITY);this.br.forEachInRange([e,s],(t=>{n=n.add(t.wr)}))})),Ae.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;we.isDocumentKey(i)||(i=i.child(""));const r=new ar(new we(i),0);let o=new Ve(le);return this.br.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.wr)),!0)}),r),Ae.resolve(this.Cr(o))}Cr(t){const e=[];return t.forEach((t=>{const n=this.Dr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Yt(0===this.Fr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return Ae.forEach(e.mutations,(s=>{const i=new ar(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.br=n}))}On(t){}containsKey(t,e){const n=new ar(e,0),s=this.br.firstAfterOrEqual(n);return Ae.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ae.resolve()}Fr(t,e){return this.vr(t)}vr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Dr(t){const e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class cr{constructor(t){this.Mr=t,this.docs=new Oe(we.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.Mr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ae.resolve(n?n.document.mutableCopy():vn.newInvalidDocument(e))}getEntries(t,e){let n=as();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():vn.newInvalidDocument(t))})),Ae.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=as();const r=e.path,o=new we(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||Te(_e(o),n)<=0||(s.has(o.key)||ns(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Ae.resolve(i)}getAllFromCollectionGroup(t,e,n,s){Qt()}Or(t,e){return Ae.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ur(this)}getSize(t){return Ae.resolve(this.size)}}class ur extends tr{constructor(t){super(),this.cr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.cr.addEntry(t,s)):this.cr.removeEntry(n)})),Ae.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}}class lr{constructor(t){this.persistence=t,this.Nr=new rs((t=>qn(t)),Hn),this.lastRemoteSnapshotVersion=pe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new or,this.targetCount=0,this.kr=Zi.Bn()}forEachTarget(t,e){return this.Nr.forEach(((t,n)=>e(n))),Ae.resolve()}getLastRemoteSnapshotVersion(t){return Ae.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ae.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),Ae.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Lr&&(this.Lr=e),Ae.resolve()}Kn(t){this.Nr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.kr=new Zi(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,Ae.resolve()}updateTargetData(t,e){return this.Kn(e),Ae.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,Ae.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Nr.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Nr.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Ae.waitFor(i).next((()=>s))}getTargetCount(t){return Ae.resolve(this.targetCount)}getTargetData(t,e){const n=this.Nr.get(e)||null;return Ae.resolve(n)}addMatchingKeys(t,e,n){return this.Br.Rr(e,n),Ae.resolve()}removeMatchingKeys(t,e,n){this.Br.mr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),Ae.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),Ae.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Br.yr(e);return Ae.resolve(n)}containsKey(t,e){return Ae.resolve(this.Br.containsKey(e))}}class dr{constructor(t,e){this.qr={},this.overlays={},this.Qr=new De(0),this.Kr=!1,this.Kr=!0,this.$r=new rr,this.referenceDelegate=t(this),this.Ur=new lr(this),this.indexManager=new Yi,this.remoteDocumentCache=function(t){return new cr(t)}((t=>this.referenceDelegate.Wr(t))),this.serializer=new Ki(e),this.Gr=new sr(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new ir,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.qr[t.toKey()];return n||(n=new hr(e,this.referenceDelegate),this.qr[t.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,n){Gt("MemoryPersistence","Starting transaction:",t);const s=new fr(this.Qr.next());return this.referenceDelegate.zr(),n(s).next((t=>this.referenceDelegate.jr(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Hr(t,e){return Ae.or(Object.values(this.qr).map((n=>()=>n.containsKey(t,e))))}}class fr extends Ie{constructor(t){super(),this.currentSequenceNumber=t}}class pr{constructor(t){this.persistence=t,this.Jr=new or,this.Yr=null}static Zr(t){return new pr(t)}get Xr(){if(this.Yr)return this.Yr;throw Qt()}addReference(t,e,n){return this.Jr.addReference(n,e),this.Xr.delete(n.toString()),Ae.resolve()}removeReference(t,e,n){return this.Jr.removeReference(n,e),this.Xr.add(n.toString()),Ae.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),Ae.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach((t=>this.Xr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Xr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}zr(){this.Yr=new Set}jr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ae.forEach(this.Xr,(n=>{const s=we.fromPath(n);return this.ei(t,s).next((t=>{t||e.removeEntry(s,pe.min())}))})).next((()=>(this.Yr=null,e.apply(t))))}updateLimboDocument(t,e){return this.ei(t,e).next((t=>{t?this.Xr.delete(e.toString()):this.Xr.add(e.toString())}))}Wr(t){return 0}ei(t,e){return Ae.or([()=>Ae.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}}class mr{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.$i=n,this.Ui=s}static Wi(t,e){let n=gs(),s=gs();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new mr(t,e.fromCache,n,s)}}class gr{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class yr{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=!function(){var e;const n=null===(e=m())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.Yi(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Zi(t,e,s,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new gr;return this.Xi(t,e,n).next((s=>{if(i.result=s,this.zi)return this.es(t,e,n,s.size)}))})).next((()=>i.result))}es(t,e,n,s){return n.documentReadCount<this.ji?($t()<=R.DEBUG&&Gt("QueryEngine","SDK will not create cache indexes for query:",es(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Ae.resolve()):($t()<=R.DEBUG&&Gt("QueryEngine","Query:",es(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?($t()<=R.DEBUG&&Gt("QueryEngine","The SDK decides to create cache indexes for query:",es(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Yn(e))):Ae.resolve())}Yi(t,e){if(Kn(e))return Ae.resolve(null);let n=Yn(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=Jn(e,null,"F"),n=Yn(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const i=gs(...s);return this.Ji.getDocuments(t,i).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.ts(e,s);return this.ns(e,r,i,n.readTime)?this.Yi(t,Jn(e,null,"F")):this.rs(t,r,e,n)}))))})))))}Zi(t,e,n,s){return Kn(e)||s.isEqual(pe.min())?Ae.resolve(null):this.Ji.getDocuments(t,n).next((i=>{const r=this.ts(e,i);return this.ns(e,r,n,s)?Ae.resolve(null):($t()<=R.DEBUG&&Gt("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),es(e)),this.rs(t,r,e,function(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=pe.fromTimestamp(1e9===s?new fe(n+1,0):new fe(n,s));return new Ee(i,we.empty(),e)}(s,-1)).next((t=>t)))}))}ts(t,e){let n=new Ve(ss(t));return e.forEach(((e,s)=>{ns(t,s)&&(n=n.add(s))})),n}ns(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(t,e,n){return $t()<=R.DEBUG&&Gt("QueryEngine","Using full collection scan to execute query:",es(e)),this.Ji.getDocumentsMatchingQuery(t,e,Ee.min(),n)}rs(t,e,n,s){return this.Ji.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class vr{constructor(t,e,n,s){this.persistence=t,this.ss=e,this.serializer=s,this.os=new Oe(le),this._s=new rs((t=>qn(t)),Hn),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(n)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new nr(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.os)))}}async function wr(t,e){const n=Xt(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((i=>(s=i,n.ls(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=gs();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({hs:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function _r(t){const e=Xt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function Er(t,e){const n=Xt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function Tr(t,e,n){const s=Xt(t),i=s.os.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Ce(t))throw t;Gt("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.os=s.os.remove(e),s._s.delete(i.target)}function br(t,e,n){const s=Xt(t);let i=pe.min(),r=gs();return s.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const s=Xt(t),i=s._s.get(n);return void 0!==i?Ae.resolve(s.os.get(i)):s.Ur.getTargetData(e,n)}(s,t,Yn(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.ss.getDocumentsMatchingQuery(t,e,n?i:pe.min(),n?r:gs()))).next((t=>(function(t,e,n){let s=t.us.get(e)||pe.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.us.set(e,s)}(s,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Ts:r})))))}class Ir{constructor(){this.activeTargetIds=ys}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Sr{constructor(){this.so=new Ir,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,n){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new Ir,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ar{_o(t){}shutdown(){}}class Cr{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Gt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){Gt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Dr=null;function Rr(){return null===Dr?Dr=268435456+Math.round(2147483648*Math.random()):Dr++,"0x"+Dr.toString(16)}const Nr={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kr{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}const Mr="WebChannelConnection";class xr extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=e+"://"+t.host,this.vo=`projects/${n}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${s}`}get Fo(){return!1}Mo(t,e,n,s,i){const r=Rr(),o=this.xo(t,e.toUriEncodedString());Gt("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const a={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(a,s,i),this.No(t,o,a,n).then((e=>(Gt("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw Kt("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}Lo(t,e,n,s,i,r){return this.Mo(t,e,n,s,i)}Oo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+qt,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}xo(t,e){const n=Nr[t];return`${this.Do}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,n,s){const i=Rr();return new Promise(((r,o)=>{const a=new Rt;a.setWithCredentials(!0),a.listenOnce(Mt.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case xt.NO_ERROR:const e=a.getResponseJson();Gt(Mr,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),r(e);break;case xt.TIMEOUT:Gt(Mr,`RPC '${t}' ${i} timed out`),o(new Zt(Jt.DEADLINE_EXCEEDED,"Request time out"));break;case xt.HTTP_ERROR:const n=a.getStatus();if(Gt(Mr,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Jt).indexOf(e)>=0?e:Jt.UNKNOWN}(e.status);o(new Zt(t,e.message))}else o(new Zt(Jt.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Zt(Jt.UNAVAILABLE,"Connection failed."));break;default:Qt()}}finally{Gt(Mr,`RPC '${t}' ${i} completed.`)}}));const h=JSON.stringify(s);Gt(Mr,`RPC '${t}' ${i} sending request:`,s),a.send(e,"POST",h,n,15)}))}Bo(t,e,n){const s=Rr(),i=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Vt(),o=Pt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(a.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(a.xmlHttpFactory=new Nt({})),this.Oo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const c=i.join("");Gt(Mr,`Creating RPC '${t}' stream ${s}: ${c}`,a);const u=r.createWebChannel(c,a);let l=!1,d=!1;const f=new kr({Io:e=>{d?Gt(Mr,`Not sending because RPC '${t}' stream ${s} is closed:`,e):(l||(Gt(Mr,`Opening RPC '${t}' stream ${s} transport.`),u.open(),l=!0),Gt(Mr,`RPC '${t}' stream ${s} sending:`,e),u.send(e))},To:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,kt.EventType.OPEN,(()=>{d||(Gt(Mr,`RPC '${t}' stream ${s} transport opened.`),f.yo())})),p(u,kt.EventType.CLOSE,(()=>{d||(d=!0,Gt(Mr,`RPC '${t}' stream ${s} transport closed`),f.So())})),p(u,kt.EventType.ERROR,(e=>{d||(d=!0,Kt(Mr,`RPC '${t}' stream ${s} transport errored:`,e),f.So(new Zt(Jt.UNAVAILABLE,"The operation could not be completed")))})),p(u,kt.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Yt(!!i);const r=i,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){Gt(Mr,`RPC '${t}' stream ${s} received error:`,o);const e=o.status;let n=function(t){const e=Zs[t];if(void 0!==e)return ei(e)}(e),i=o.message;void 0===n&&(n=Jt.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.So(new Zt(n,i)),u.close()}else Gt(Mr,`RPC '${t}' stream ${s} received:`,i),f.bo(i)}})),p(o,Lt.STAT_EVENT,(e=>{e.stat===Ot.PROXY?Gt(Mr,`RPC '${t}' stream ${s} detected buffering proxy`):e.stat===Ot.NOPROXY&&Gt(Mr,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{f.wo()}),0),f}}function Or(){return"undefined"!=typeof document?document:null}function Lr(t){return new wi(t,!0)}class Pr{constructor(t,e,n=1e3,s=1.5,i=6e4){this.ui=t,this.timerId=e,this.ko=n,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const e=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,e-n);s>0&&Gt("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,(()=>(this.Uo=Date.now(),t()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Vr{constructor(t,e,n,s,i,r,o,a){this.ui=t,this.Ho=n,this.Jo=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Pr(t,e)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,e){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==t?this.t_.reset():e&&e.code===Jt.RESOURCE_EXHAUSTED?(zt(e.toString()),zt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===Jt.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(e)}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Yo===e&&this.P_(t,n)}),(e=>{t((()=>{const t=new Zt(Jt.UNKNOWN,"Fetching auth token failed: "+e.message);return this.I_(t)}))}))}P_(t,e){const n=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((t=>{n((()=>this.I_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.e_?this.E_(t):this.onNext(t)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(t){return Gt("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget((()=>this.Yo===t?e():(Gt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Fr extends Vr{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.serializer=i}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Qt()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.useProto3Json?(Yt(void 0===e||"string"==typeof e),je.fromBase64String(e||"")):(Yt(void 0===e||e instanceof Buffer||e instanceof Uint8Array),je.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Jt.UNKNOWN:ei(t.code);return new Zt(e,t.message||"")}(o);n=new li(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Ri(t,s.document.name),r=Ii(s.document.updateTime),o=s.document.createTime?Ii(s.document.createTime):pe.min(),a=new gn({mapValue:{fields:s.document.fields}}),h=vn.newFoundDocument(i,r,o,a),c=s.targetIds||[],u=s.removedTargetIds||[];n=new ci(c,u,h.key,h)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Ri(t,s.document),r=s.readTime?Ii(s.readTime):pe.min(),o=vn.newNoDocument(i,r),a=s.removedTargetIds||[];n=new ci([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Ri(t,s.document),r=s.removedTargetIds||[];n=new ci([],r,i,null)}else{if(!("filter"in e))return Qt();{e.filter;const t=e.filter;t.targetId;const{count:s=0,unchangedNames:i}=t,r=new Js(s,i),o=t.targetId;n=new ui(o,r)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return pe.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?pe.min():e.readTime?Ii(e.readTime):pe.min()}(t);return this.listener.d_(e,n)}A_(t){const e={};e.database=ki(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;if(n=$n(s)?{documents:Oi(t,s)}:{query:Li(t,s)._t},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Ti(t,e.resumeToken);const s=_i(t,e.expectedCount);null!==s&&(n.expectedCount=s)}else if(e.snapshotVersion.compareTo(pe.min())>0){n.readTime=Ei(t,e.snapshotVersion.toTimestamp());const s=_i(t,e.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qt()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.a_(e)}R_(t){const e={};e.database=ki(this.serializer),e.removeTarget=t,this.a_(e)}}class Ur extends Vr{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return Yt(!!t.streamToken),this.lastStreamToken=t.streamToken,Yt(!t.writeResults||0===t.writeResults.length),this.listener.f_()}onNext(t){Yt(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const e=function(t,e){return t&&t.length>0?(Yt(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ii(t.updateTime):Ii(e);return n.isEqual(pe.min())&&(n=Ii(e)),new xs(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ii(t.commitTime);return this.listener.g_(n,e)}p_(){const t={};t.database=ki(this.serializer),this.a_(t)}m_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof qs)n={update:xi(t,e.key,e.value)};else if(e instanceof Ks)n={delete:Di(t,e.key)};else if(e instanceof Hs)n={update:xi(t,e.key,e.data),updateMask:$i(e.fieldMask)};else{if(!(e instanceof Ws))return Qt();n={verify:Di(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ss)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof As)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ds)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ns)return{fieldPath:e.field.canonicalString(),increment:n.Pe};throw Qt()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:bi(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Qt()}(t,e.precondition)),n}(this.serializer,t)))};this.a_(e)}}class Br extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Zt(Jt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Mo(t,Ai(e,n),s,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Jt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Zt(Jt.UNKNOWN,t.toString())}))}Lo(t,e,n,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Lo(t,Ai(e,n),s,r,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Jt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Zt(Jt.UNKNOWN,t.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class jr{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(t){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,"Online"===t&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(zt(e),this.D_=!1):Gt("OnlineStateTracker",e)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class qr{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o((t=>{n.enqueueAndForget((async()=>{Xr(this)&&(Gt("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Xt(t);e.L_.add(4),await $r(e),e.q_.set("Unknown"),e.L_.delete(4),await Hr(e)}(this))}))})),this.q_=new jr(n,s)}}async function Hr(t){if(Xr(t))for(const e of t.B_)await e(!0)}async function $r(t){for(const e of t.B_)await e(!1)}function Gr(t,e){const n=Xt(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),Yr(n)?Qr(n):go(n).r_()&&Kr(n,e))}function zr(t,e){const n=Xt(t),s=go(n);n.N_.delete(e),s.r_()&&Wr(n,e),0===n.N_.size&&(s.r_()?s.o_():Xr(n)&&n.q_.set("Unknown"))}function Kr(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(pe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}go(t).A_(e)}function Wr(t,e){t.Q_.xe(e),go(t).R_(e)}function Qr(t){t.Q_=new fi({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),go(t).start(),t.q_.v_()}function Yr(t){return Xr(t)&&!go(t).n_()&&t.N_.size>0}function Xr(t){return 0===Xt(t).L_.size}function Jr(t){t.Q_=void 0}async function Zr(t){t.q_.set("Online")}async function to(t){t.N_.forEach(((e,n)=>{Kr(t,e)}))}async function eo(t,e){Jr(t),Yr(t)?(t.q_.M_(e),Qr(t)):t.q_.set("Unknown")}async function no(t,e,n){if(t.q_.set("Online"),e instanceof li&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.N_.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.N_.delete(s),t.Q_.removeTarget(s))}(t,e)}catch(n){Gt("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await so(t,n)}else if(e instanceof ci?t.Q_.Ke(e):e instanceof ui?t.Q_.He(e):t.Q_.We(e),!n.isEqual(pe.min()))try{const e=await _r(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Q_.rt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.N_.get(s);i&&t.N_.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const s=t.N_.get(e);if(!s)return;t.N_.set(e,s.withResumeToken(je.EMPTY_BYTE_STRING,s.snapshotVersion)),Wr(t,e);const i=new zi(s.target,e,n,s.sequenceNumber);Kr(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Gt("RemoteStore","Failed to raise snapshot:",e),await so(t,e)}}async function so(t,e,n){if(!Ce(e))throw e;t.L_.add(1),await $r(t),t.q_.set("Offline"),n||(n=()=>_r(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Gt("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Hr(t)}))}function io(t,e){return e().catch((n=>so(t,n,e)))}async function ro(t){const e=Xt(t),n=yo(e);let s=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;oo(e);)try{const t=await Er(e.localStore,s);if(null===t){0===e.O_.length&&n.o_();break}s=t.batchId,ao(e,t)}catch(t){await so(e,t)}ho(e)&&co(e)}function oo(t){return Xr(t)&&t.O_.length<10}function ao(t,e){t.O_.push(e);const n=yo(t);n.r_()&&n.V_&&n.m_(e.mutations)}function ho(t){return Xr(t)&&!yo(t).n_()&&t.O_.length>0}function co(t){yo(t).start()}async function uo(t){yo(t).p_()}async function lo(t){const e=yo(t);for(const n of t.O_)e.m_(n.mutations)}async function fo(t,e,n){const s=t.O_.shift(),i=Ys.from(s,e,n);await io(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await ro(t)}async function po(t,e){e&&yo(t).V_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return Qt();case Jt.CANCELLED:case Jt.UNKNOWN:case Jt.DEADLINE_EXCEEDED:case Jt.RESOURCE_EXHAUSTED:case Jt.INTERNAL:case Jt.UNAVAILABLE:case Jt.UNAUTHENTICATED:return!1;case Jt.INVALID_ARGUMENT:case Jt.NOT_FOUND:case Jt.ALREADY_EXISTS:case Jt.PERMISSION_DENIED:case Jt.FAILED_PRECONDITION:case Jt.ABORTED:case Jt.OUT_OF_RANGE:case Jt.UNIMPLEMENTED:case Jt.DATA_LOSS:return!0}}(t)&&t!==Jt.ABORTED}(e.code)){const n=t.O_.shift();yo(t).s_(),await io(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await ro(t)}}(t,e),ho(t)&&co(t)}async function mo(t,e){const n=Xt(t);n.asyncQueue.verifyOperationInProgress(),Gt("RemoteStore","RemoteStore received new credentials");const s=Xr(n);n.L_.add(3),await $r(n),s&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Hr(n)}function go(t){return t.K_||(t.K_=function(t,e,n){const s=Xt(t);return s.w_(),new Fr(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{Eo:Zr.bind(null,t),Ro:to.bind(null,t),mo:eo.bind(null,t),d_:no.bind(null,t)}),t.B_.push((async e=>{e?(t.K_.s_(),Yr(t)?Qr(t):t.q_.set("Unknown")):(await t.K_.stop(),Jr(t))}))),t.K_}function yo(t){return t.U_||(t.U_=function(t,e,n){const s=Xt(t);return s.w_(),new Ur(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:uo.bind(null,t),mo:po.bind(null,t),f_:lo.bind(null,t),g_:fo.bind(null,t)}),t.B_.push((async e=>{e?(t.U_.s_(),await ro(t)):(await t.U_.stop(),t.O_.length>0&&(Gt("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))}))),t.U_}class vo{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new vo(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Zt(Jt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wo(t,e){if(zt("AsyncQueue",`${e}: ${t}`),Ce(t))return new Zt(Jt.UNAVAILABLE,`${e}: ${t}`);throw t}class _o{constructor(t){this.comparator=t?(e,n)=>t(e,n)||we.comparator(e.key,n.key):(t,e)=>we.comparator(t.key,e.key),this.keyedMap=cs(),this.sortedSet=new Oe(this.comparator)}static emptySet(t){return new _o(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof _o))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new _o;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Eo{constructor(){this.W_=new Oe(we.comparator)}track(t){const e=t.doc.key,n=this.W_.get(e);n?0!==t.type&&3===n.type?this.W_=this.W_.insert(e,t):3===t.type&&1!==n.type?this.W_=this.W_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.W_=this.W_.remove(e):1===t.type&&2===n.type?this.W_=this.W_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):Qt():this.W_=this.W_.insert(e,t)}G_(){const t=[];return this.W_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class To{constructor(t,e,n,s,i,r,o,a,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,s,i){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new To(t,e,_o.emptySet(e),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Zn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class bo{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((t=>t.J_()))}}class Io{constructor(){this.queries=So(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,e){const n=Xt(t),s=n.queries;n.queries=So(),s.forEach(((t,n)=>{for(const t of n.j_)t.onError(e)}))}(this,new Zt(Jt.ABORTED,"Firestore shutting down"))}}function So(){return new rs((t=>ts(t)),Zn)}function Ao(t,e){const n=Xt(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.j_)e.X_(t)&&(s=!0);i.z_=t}}s&&Do(n)}function Co(t,e,n){const s=Xt(t),i=s.queries.get(e);if(i)for(const t of i.j_)t.onError(n);s.queries.delete(e)}function Do(t){t.Y_.forEach((t=>{t.next()}))}var Ro,No;(No=Ro||(Ro={})).ea="default",No.Cache="cache";class ko{constructor(t,e,n){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new To(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==e;return(!this.options._a||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ia(t){if(t.docChanges.length>0)return!0;const e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}oa(t){t=To.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==Ro.Cache}}class Mo{constructor(t){this.key=t}}class xo{constructor(t){this.key=t}}class Oo{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=gs(),this.mutatedKeys=gs(),this.Aa=ss(t),this.Ra=new _o(this.Aa)}get Va(){return this.Ta}ma(t,e){const n=e?e.fa:new Eo,s=e?e.Ra:this.Ra;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,h="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const c=s.get(t),u=ns(this.query,e)?e:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.ga(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Aa(u,a)>0||h&&this.Aa(u,h)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||h)&&(o=!0)),f&&(u?(r=r.add(u),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ra:r,fa:n,ns:o,mutatedKeys:i}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;const r=t.fa.G_();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qt()}};return n(t)-n(e)}(t.type,e.type)||this.Aa(t.doc,e.doc))),this.pa(n),s=null!=s&&s;const o=e&&!s?this.ya():[],a=0===this.da.size&&this.current&&!s?1:0,h=a!==this.Ea;return this.Ea=a,0!==r.length||h?{snapshot:new To(this.query,t.Ra,i,r,t.mutatedKeys,0===a,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}Z_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Eo,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=t.current)}ya(){if(!this.current)return[];const t=this.da;this.da=gs(),this.Ra.forEach((t=>{this.Sa(t.key)&&(this.da=this.da.add(t.key))}));const e=[];return t.forEach((t=>{this.da.has(t)||e.push(new xo(t))})),this.da.forEach((n=>{t.has(n)||e.push(new Mo(n))})),e}ba(t){this.Ta=t.Ts,this.da=gs();const e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return To.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Lo{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Po{constructor(t){this.key=t,this.va=!1}}class Vo{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Ca={},this.Fa=new rs((t=>ts(t)),Zn),this.Ma=new Map,this.xa=new Set,this.Oa=new Oe(we.comparator),this.Na=new Map,this.La=new or,this.Ba={},this.ka=new Map,this.qa=Zi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function Fo(t,e,n=!0){const s=ia(t);let i;const r=s.Fa.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.Da()):i=await Bo(s,e,n,!0),i}async function Uo(t,e){const n=ia(t);await Bo(n,e,!0,!1)}async function Bo(t,e,n,s){const i=await function(t,e){const n=Xt(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Ur.getTargetData(t,e).next((i=>i?(s=i,Ae.resolve(s)):n.Ur.allocateTargetId(t).next((i=>(s=new zi(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Ur.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.os.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(t.targetId,t),n._s.set(e,t.targetId)),t}))}(t.localStore,Yn(e)),r=i.targetId,o=t.sharedClientState.addLocalQueryTarget(r,n);let a;return s&&(a=await async function(t,e,n,s,i){t.Ka=(e,n,s)=>async function(t,e,n,s){let i=e.view.ma(n);i.ns&&(i=await br(t.localStore,e.query,!1).then((({documents:t})=>e.view.ma(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=s&&null!=s.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,r,o);return Jo(t,e.targetId,a.wa),a.snapshot}(t,e,n,s);const r=await br(t.localStore,e,!0),o=new Oo(e,r.Ts),a=o.ma(r.documents),h=hi.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,i),c=o.applyChanges(a,t.isPrimaryClient,h);Jo(t,n,c.wa);const u=new Lo(e,n,o);return t.Fa.set(e,u),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),c.snapshot}(t,e,r,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Gr(t.remoteStore,i),a}async function jo(t,e,n){const s=Xt(t),i=s.Fa.get(e),r=s.Ma.get(i.targetId);if(r.length>1)return s.Ma.set(i.targetId,r.filter((t=>!Zn(t,e)))),void s.Fa.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Tr(s.localStore,i.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(i.targetId),n&&zr(s.remoteStore,i.targetId),Yo(s,i.targetId)})).catch(Se)):(Yo(s,i.targetId),await Tr(s.localStore,i.targetId,!0))}async function qo(t,e){const n=Xt(t),s=n.Fa.get(e),i=n.Ma.get(s.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),zr(n.remoteStore,s.targetId))}async function Ho(t,e){const n=Xt(t);try{const t=await function(t,e){const n=Xt(t),s=e.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const o=[];e.targetChanges.forEach(((r,a)=>{const h=i.get(a);if(!h)return;o.push(n.Ur.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Ur.addMatchingKeys(t,r.addedDocuments,a))));let c=h.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?c=c.withResumeToken(je.EMPTY_BYTE_STRING,pe.min()).withLastLimboFreeSnapshotVersion(pe.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,s)),i=i.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(h,c,r)&&o.push(n.Ur.updateTargetData(t,c))}));let a=as(),h=gs();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(function(t,e,n){let s=gs(),i=gs();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=as();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(pe.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):Gt("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Ps:s,Is:i}}))}(t,r,e.documentUpdates).next((t=>{a=t.Ps,h=t.Is}))),!s.isEqual(pe.min())){const e=n.Ur.getLastRemoteSnapshotVersion(t).next((e=>n.Ur.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Ae.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,h))).next((()=>a))})).then((t=>(n.os=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Na.get(e);s&&(Yt(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.va=!0:t.modifiedDocuments.size>0?Yt(s.va):t.removedDocuments.size>0&&(Yt(s.va),s.va=!1))})),await ea(n,t,e)}catch(t){await Se(t)}}function $o(t,e,n){const s=Xt(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Fa.forEach(((n,s)=>{const i=s.view.Z_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Xt(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.j_)t.Z_(e)&&(s=!0)})),s&&Do(n)}(s.eventManager,e),t.length&&s.Ca.d_(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Go(t,e,n){const s=Xt(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Na.get(e),r=i&&i.key;if(r){let t=new Oe(we.comparator);t=t.insert(r,vn.newNoDocument(r,pe.min()));const n=gs().add(r),i=new ai(pe.min(),new Map,new Oe(le),t,n);await Ho(s,i),s.Oa=s.Oa.remove(r),s.Na.delete(e),ta(s)}else await Tr(s.localStore,e,!1).then((()=>Yo(s,e,n))).catch(Se)}async function zo(t,e){const n=Xt(t),s=e.batch.batchId;try{const t=await function(t,e){const n=Xt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Ae.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);Yt(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=gs();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(n.localStore,e);Qo(n,s,null),Wo(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await ea(n,t)}catch(t){await Se(t)}}async function Ko(t,e,n){const s=Xt(t);try{const t=await function(t,e){const n=Xt(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Yt(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);Qo(s,e,n),Wo(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await ea(s,t)}catch(n){await Se(n)}}function Wo(t,e){(t.ka.get(e)||[]).forEach((t=>{t.resolve()})),t.ka.delete(e)}function Qo(t,e,n){const s=Xt(t);let i=s.Ba[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.Ba[s.currentUser.toKey()]=i}}function Yo(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Ma.get(e))t.Fa.delete(s),n&&t.Ca.$a(s,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach((e=>{t.La.containsKey(e)||Xo(t,e)}))}function Xo(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);null!==n&&(zr(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),ta(t))}function Jo(t,e,n){for(const s of n)s instanceof Mo?(t.La.addReference(s.key,e),Zo(t,s)):s instanceof xo?(Gt("SyncEngine","Document no longer in limbo: "+s.key),t.La.removeReference(s.key,e),t.La.containsKey(s.key)||Xo(t,s.key)):Qt()}function Zo(t,e){const n=e.key,s=n.path.canonicalString();t.Oa.get(n)||t.xa.has(s)||(Gt("SyncEngine","New document in limbo: "+n),t.xa.add(s),ta(t))}function ta(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new we(ge.fromString(e)),s=t.qa.next();t.Na.set(s,new Po(n)),t.Oa=t.Oa.insert(n,s),Gr(t.remoteStore,new zi(Yn(zn(n.path)),s,"TargetPurposeLimboResolution",De.oe))}}async function ea(t,e,n){const s=Xt(t),i=[],r=[],o=[];s.Fa.isEmpty()||(s.Fa.forEach(((t,a)=>{o.push(s.Ka(a,e,n).then((t=>{var e;if((t||n)&&s.isPrimaryClient){const i=t?!t.fromCache:null===(e=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;s.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);const e=mr.Wi(a.targetId,t);r.push(e)}})))})),await Promise.all(o),s.Ca.d_(i),await async function(t,e){const n=Xt(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ae.forEach(e,(e=>Ae.forEach(e.$i,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Ae.forEach(e.Ui,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!Ce(t))throw t;Gt("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.os.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.os=n.os.insert(e,i)}}}(s.localStore,r))}async function na(t,e){const n=Xt(t);if(!n.currentUser.isEqual(e)){Gt("SyncEngine","User change. New user:",e.toKey());const t=await wr(n.localStore,e);n.currentUser=e,function(t,e){t.ka.forEach((t=>{t.forEach((t=>{t.reject(new Zt(Jt.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ka.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ea(n,t.hs)}}function sa(t,e){const n=Xt(t),s=n.Na.get(e);if(s&&s.va)return gs().add(s.key);{let t=gs();const s=n.Ma.get(e);if(!s)return t;for(const e of s){const s=n.Fa.get(e);t=t.unionWith(s.view.Va)}return t}}function ia(t){const e=Xt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ho.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sa.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Go.bind(null,e),e.Ca.d_=Ao.bind(null,e.eventManager),e.Ca.$a=Co.bind(null,e.eventManager),e}function ra(t){const e=Xt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zo.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ko.bind(null,e),e}class oa{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Lr(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,s){return new vr(t,e,n,s)}(this.persistence,new yr,t.initialUser,this.serializer)}createPersistence(t){return new dr(pr.Zr,this.serializer)}createSharedClientState(t){return new Sr}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class aa{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>$o(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=na.bind(null,this.syncEngine),await async function(t,e){const n=Xt(t);e?(n.L_.delete(2),await Hr(n)):e||(n.L_.add(2),await $r(n),n.q_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Io}createDatastore(t){const e=Lr(t.databaseInfo.databaseId),n=function(t){return new xr(t)}(t.databaseInfo);return function(t,e,n,s){return new Br(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,s,i){return new qr(t,e,n,s,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>$o(this.syncEngine,t,0)),Cr.D()?new Cr:new Ar)}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const a=new Vo(t,e,n,s,i,r);return o&&(a.Qa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=Xt(t);Gt("RemoteStore","RemoteStore shutting down."),e.L_.add(5),await $r(e),e.k_.shutdown(),e.q_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}class ha{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ga(this.observer.next,t)}error(t){this.observer.error?this.Ga(this.observer.error,t):zt("Uncaught Error in snapshot listener:",t.toString())}za(){this.muted=!0}Ga(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class ca{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=jt.UNAUTHENTICATED,this.clientId=ue.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Gt("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Gt("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Zt(Jt.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=wo(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function ua(t,e){t.asyncQueue.verifyOperationInProgress(),Gt("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await wr(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function la(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Gt("FirestoreClient","Using user provided OfflineComponentProvider");try{await ua(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Jt.FAILED_PRECONDITION||t.code===Jt.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Kt("Error using user provided cache. Falling back to memory cache: "+n),await ua(t,new oa)}}else Gt("FirestoreClient","Using default OfflineComponentProvider"),await ua(t,new oa);return t._offlineComponents}(t);Gt("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>mo(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>mo(e.remoteStore,n))),t._onlineComponents=e}async function da(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Gt("FirestoreClient","Using user provided OnlineComponentProvider"),await la(t,t._uninitializedComponentsProvider._online)):(Gt("FirestoreClient","Using default OnlineComponentProvider"),await la(t,new aa))),t._onlineComponents}async function fa(t){const e=await da(t),n=e.eventManager;return n.onListen=Fo.bind(null,e.syncEngine),n.onUnlisten=jo.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Uo.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=qo.bind(null,e.syncEngine),n}function pa(t,e,n={}){const s=new te;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ha({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Xt(t),s=e.query;let i=3;const r=n.queries.get(s);if(r){const t=r.j_.indexOf(e);t>=0&&(r.j_.splice(t,1),0===r.j_.length?i=e.J_()?0:1:!r.H_()&&e.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}(t,o))),n.fromCache&&"server"===s.source?i.reject(new Zt(Jt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new ko(n,r,{includeMetadataChanges:!0,_a:!0});return async function(t,e){const n=Xt(t);let s=3;const i=e.query;let r=n.queries.get(i);r?!r.H_()&&e.J_()&&(s=2):(r=new bo,s=e.J_()?0:1);try{switch(s){case 0:r.z_=await n.onListen(i,!0);break;case 1:r.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=wo(t,`Initialization of query '${es(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.j_.push(e),e.Z_(n.onlineState),r.z_&&e.X_(r.z_)&&Do(n)}(t,o)}(await fa(t),t.asyncQueue,e,n,s))),s.promise}function ma(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const ga=new Map;function ya(t,e,n){if(!n)throw new Zt(Jt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function va(t){if(!we.isDocumentKey(t))throw new Zt(Jt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function wa(t){if(we.isDocumentKey(t))throw new Zt(Jt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function _a(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Qt()}function Ea(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Zt(Jt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=_a(t);throw new Zt(Jt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Ta{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Zt(Jt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Zt(Jt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,s){if(!0===e&&!0===s)throw new Zt(Jt.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ma(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Zt(Jt.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Zt(Jt.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Zt(Jt.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ba{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ta({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Zt(Jt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Zt(Jt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ta(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new ne;switch(t.type){case"firstParty":return new oe(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Zt(Jt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ga.get(t);e&&(Gt("ComponentProvider","Removing Datastore"),ga.delete(t),e.terminate())}(this),Promise.resolve()}}class Ia{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Ia(this.firestore,t,this._query)}}class Sa{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Aa(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Sa(this.firestore,t,this._key)}}class Aa extends Ia{constructor(t,e,n){super(t,e,zn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Sa(this.firestore,null,new we(t))}withConverter(t){return new Aa(this.firestore,t,this._path)}}function Ca(t,e,...n){if(t=b(t),ya("collection","path",e),t instanceof ba){const s=ge.fromString(e,...n);return wa(s),new Aa(t,null,s)}{if(!(t instanceof Sa||t instanceof Aa))throw new Zt(Jt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(ge.fromString(e,...n));return wa(s),new Aa(t.firestore,null,s)}}class Da{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Pr(this,"async_queue_retry"),this.Eu=()=>{const t=Or();t&&Gt("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const t=Or();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.du(),this.Au(t)}enterRestrictedMode(t){if(!this.cu){this.cu=!0,this.Iu=t||!1;const e=Or();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Eu)}}enqueue(t){if(this.du(),this.cu)return new Promise((()=>{}));const e=new te;return this.Au((()=>this.cu&&this.Iu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.uu.push(t),this.Ru())))}async Ru(){if(0!==this.uu.length){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(t){if(!Ce(t))throw t;Gt("AsyncQueue","Operation failed with retryable error: "+t)}this.uu.length>0&&this.t_.Go((()=>this.Ru()))}}Au(t){const e=this.au.then((()=>(this.Pu=!0,t().catch((t=>{this.hu=t,this.Pu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw zt("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Pu=!1,t))))));return this.au=e,e}enqueueAfterDelay(t,e,n){this.du(),this.Tu.indexOf(t)>-1&&(e=0);const s=vo.createAndSchedule(this,t,e,n,(t=>this.Vu(t)));return this.lu.push(s),s}du(){this.hu&&Qt()}verifyOperationInProgress(){}async mu(){let t;do{t=this.au,await t}while(t!==this.au)}fu(t){for(const e of this.lu)if(e.timerId===t)return!0;return!1}gu(t){return this.mu().then((()=>{this.lu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.lu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.mu()}))}pu(t){this.Tu.push(t)}Vu(t){const e=this.lu.indexOf(t);this.lu.splice(e,1)}}class Ra extends ba{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Da,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ka(this),this._firestoreClient.terminate()}}function Na(t){return t._firestoreClient||ka(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ka(t){var e,n,s;const i=t._freezeSettings(),r=function(t,e,n,s){return new Qe(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,ma(s.experimentalLongPollingOptions),s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new ca(t._authCredentials,t._appCheckCredentials,t._queue,r),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.localCache)||void 0===s?void 0:s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Ma{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ma(je.fromBase64String(t))}catch(t){throw new Zt(Jt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ma(je.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class xa{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Zt(Jt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ve(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Oa{constructor(t){this._methodName=t}}class La{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Zt(Jt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Zt(Jt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return le(this._lat,t._lat)||le(this._long,t._long)}}class Pa{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}}const Va=/^__.*__$/;class Fa{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Hs(t,this.data,this.fieldMask,e,this.fieldTransforms):new qs(t,this.data,e,this.fieldTransforms)}}function Ua(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qt()}}class Ba{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.yu(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(t){return new Ba(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Su({path:n,Du:!1});return s.vu(t),s}Cu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Su({path:n,Du:!1});return s.yu(),s}Fu(t){return this.Su({path:void 0,Du:!0})}Mu(t){return Xa(t,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}yu(){if(this.path)for(let t=0;t<this.path.length;t++)this.vu(this.path.get(t))}vu(t){if(0===t.length)throw this.Mu("Document fields must not be empty");if(Ua(this.wu)&&Va.test(t))throw this.Mu('Document fields cannot begin and end with "__"')}}class ja{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Lr(t)}Nu(t,e,n,s=!1){return new Ba({wu:t,methodName:e,Ou:n,path:ve.emptyPath(),Du:!1,xu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function qa(t){const e=t._freezeSettings(),n=Lr(t._databaseId);return new ja(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ha(t,e,n,s,i,r={}){const o=t.Nu(r.merge||r.mergeFields?2:0,e,n,i);Ka("Data must be an object, but it was:",o,s);const a=Ga(s,o);let h,c;if(r.merge)h=new Ue(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=Wa(e,s,n);if(!o.contains(i))throw new Zt(Jt.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ja(t,i)||t.push(i)}h=new Ue(t),c=o.fieldTransforms.filter((t=>h.covers(t.field)))}else h=null,c=o.fieldTransforms;return new Fa(new gn(a),h,c)}function $a(t,e){if(za(t=b(t)))return Ka("Unsupported field value:",e,t),Ga(t,e);if(t instanceof Oa)return function(t,e){if(!Ua(e.wu))throw e.Mu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Mu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=$a(i,e.Fu(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return _s(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=fe.fromDate(t);return{timestampValue:Ei(e.serializer,n)}}if(t instanceof fe){const n=new fe(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ei(e.serializer,n)}}if(t instanceof La)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ma)return{bytesValue:Ti(e.serializer,t._byteString)};if(t instanceof Sa){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.Mu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Si(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof Pa)return function(t,e){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.Mu("VectorValues must only contain numeric values.");return vs(e.serializer,t)}))}}}}}}(t,e);throw e.Mu(`Unsupported field value: ${_a(t)}`)}(t,e)}function Ga(t,e){const n={};return xe(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Me(t,((t,s)=>{const i=$a(s,e.bu(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function za(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof fe||t instanceof La||t instanceof Ma||t instanceof Sa||t instanceof Oa||t instanceof Pa)}function Ka(t,e,n){if(!za(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=_a(n);throw"an object"===s?e.Mu(t+" a custom object"):e.Mu(t+" "+s)}}function Wa(t,e,n){if((e=b(e))instanceof xa)return e._internalPath;if("string"==typeof e)return Ya(t,e);throw Xa("Field path arguments must be of type string or ",t,!1,void 0,n)}const Qa=new RegExp("[~\\*/\\[\\]]");function Ya(t,e,n){if(e.search(Qa)>=0)throw Xa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new xa(...e.split("."))._internalPath}catch(s){throw Xa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Xa(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=` in field ${s}`),o&&(h+=` in document ${i}`),h+=")"),new Zt(Jt.INVALID_ARGUMENT,a+t+h)}function Ja(t,e){return t.some((t=>t.isEqual(e)))}class Za{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Sa(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new th(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(eh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class th extends Za{data(){return super.data()}}function eh(t,e){return"string"==typeof e?Ya(t,e):e instanceof xa?e._internalPath:e._delegate._internalPath}class nh{}class sh extends nh{}class ih extends sh{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new ih(t,e,n)}_apply(t){const e=this._parse(t);return uh(t._query,e),new Ia(t.firestore,t.converter,Xn(t._query,e))}_parse(t){const e=qa(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new Zt(Jt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){ch(o,r);const e=[];for(const n of o)e.push(hh(s,t,n));a={arrayValue:{values:e}}}else a=hh(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||ch(o,r),a=function(t,e,n,s=!1){return $a(n,t.Nu(s?4:3,e))}(n,"where",o,"in"===r||"not-in"===r);return Sn.create(i,r,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class rh extends nh{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new rh(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:An.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const s=e.getFlattenedFilters();for(const t of s)uh(n,t),n=Xn(n,t)}(t._query,e),new Ia(t.firestore,t.converter,Xn(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class oh extends sh{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new oh(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Zt(Jt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Zt(Jt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Tn(e,n)}(t._query,this._field,this._direction);return new Ia(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Gn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}class ah extends sh{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new ah(t,e,n)}_apply(t){return new Ia(t.firestore,t.converter,Jn(t._query,this._limit,this._limitType))}}function hh(t,e,n){if("string"==typeof(n=b(n))){if(""===n)throw new Zt(Jt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wn(e)&&-1!==n.indexOf("/"))throw new Zt(Jt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(ge.fromString(n));if(!we.isDocumentKey(s))throw new Zt(Jt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return an(t,new we(s))}if(n instanceof Sa)return an(t,n._key);throw new Zt(Jt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_a(n)}.`)}function ch(t,e){if(!Array.isArray(t)||0===t.length)throw new Zt(Jt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function uh(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Zt(Jt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Zt(Jt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class lh{convertValue(t,e="none"){switch(Je(t)){case 0:return null;case 1:return t.booleanValue;case 2:return $e(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ge(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Qt()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Me(t,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertVectorValue(t){var e,n,s;const i=null===(s=null===(n=null===(e=t.fields)||void 0===e?void 0:e.value.arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map((t=>$e(t.doubleValue)));return new Pa(i)}convertGeoPoint(t){return new La($e(t.latitude),$e(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ke(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(We(t));default:return null}}convertTimestamp(t){const e=He(t);return new fe(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ge.fromString(t);Yt(Gi(n));const s=new Ye(n.get(1),n.get(3)),i=new we(n.popFirst(5));return s.isEqual(e)||zt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class dh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class fh extends Za{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ph(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(eh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class ph extends fh{data(t={}){return super.data(t)}}class mh{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new dh(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new ph(this._firestore,this._userDataWriter,n.key,n,new dh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Zt(Jt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const s=new ph(t._firestore,t._userDataWriter,n.doc.key,n.doc,new dh(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new ph(t._firestore,t._userDataWriter,e.doc.key,e.doc,new dh(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:gh(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function gh(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qt()}}class yh extends lh{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ma(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Sa(this.firestore,null,e)}}function vh(t,e){const n=Ea(t.firestore,Ra),s=function(t,e,...n){if(t=b(t),1===arguments.length&&(e=ue.newId()),ya("doc","path",e),t instanceof ba){const s=ge.fromString(e,...n);return va(s),new Sa(t,null,new we(s))}{if(!(t instanceof Sa||t instanceof Aa))throw new Zt(Jt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(ge.fromString(e,...n));return va(s),new Sa(t.firestore,t instanceof Aa?t.converter:null,new we(s))}}(t),i=function(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}(t.converter,e);return function(t,e){return function(t,e){const n=new te;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=ra(t);try{const t=await function(t,e){const n=Xt(t),s=fe.now(),i=e.reduce(((t,e)=>t.add(e.key)),gs());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=as(),h=gs();return n.cs.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(h=h.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{r=i;const o=[];for(const t of e){const e=Bs(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Hs(t.key,e,yn(e.value.mapValue),Os.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(r,h);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:us(r)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.Ba[t.currentUser.toKey()];s||(s=new Oe(le)),s=s.insert(e,n),t.Ba[t.currentUser.toKey()]=s}(s,t.batchId,n),await ea(s,t.changes),await ro(s.remoteStore)}catch(t){const e=wo(t,"Failed to persist write");n.reject(e)}}(await function(t){return da(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Na(t),e)}(n,[Ha(qa(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,Os.exists(!1))]).then((()=>s))}new WeakMap,function(t,e=!0){qt="10.13.2",ct(new I("firestore",((t,{instanceIdentifier:n,options:s})=>{const i=t.getProvider("app").getImmediate(),r=new Ra(new ie(t.getProvider("auth-internal")),new he(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Zt(Jt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ye(t.options.projectId,e)}(i,n),i);return s=Object.assign({useFetchStreams:e},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),ft(Bt,"4.7.2",t),ft(Bt,"4.7.2","esm2017")}();const wh=function(t,e){const n="string"==typeof t?t:"(default)",s=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=st){const e=rt.get(t);if(!e&&t===st&&g())return dt();if(!e)throw ut.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!s._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=m())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),s]:[e.substring(0,n),s]})("firestore");t&&function(t,e,n,s={}){var i;const r=(t=Ea(t,ba))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==r.host&&r.host!==o&&Kt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=jt.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[p(JSON.stringify({alg:"none",type:"JWT"})),p(JSON.stringify(r)),""].join(".")}(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new Zt(Jt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new jt(r)}t._authCredentials=new se(new ee(e,n))}}(s,...t)}return s}(dt({apiKey:"AIzaSyCXSlA96Y7R-AKVidFBP1tp_yggBqFYDP4",authDomain:"typebit-cubeydice.firebaseapp.com",projectId:"typebit-cubeydice",storageBucket:"typebit-cubeydice.appspot.com",messagingSenderId:"994929917507",appId:"1:994929917507:web:88c376334d3d8648d41ef6",measurementId:"G-934MYF219Z"}));async function _h(){const t=function(t,e,...n){let s=[];e instanceof nh&&s.push(e),s=s.concat(n),function(t){const e=t.filter((t=>t instanceof rh)).length,n=t.filter((t=>t instanceof ih)).length;if(e>1||e>0&&n>0)throw new Zt(Jt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const e of s)t=e._apply(t);return t}(Ca(wh,"scores"),function(t,e="asc"){const n=e,s=eh("orderBy","score");return oh._create(s,n)}(0,"desc"),(function(t,e){if(e<=0)throw new Zt(Jt.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}("limit",10),ah._create("limit",10,"F")));const e=await function(t){t=Ea(t,Ia);const e=Ea(t.firestore,Ra),n=Na(e),s=new yh(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Zt(Jt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),pa(n,t._query).then((n=>new mh(e,s,t,n)))}(t),n=document.getElementById("scoreList");n.innerHTML="";let s=1;return e.forEach((t=>{const e=t.data(),i=document.createElement("li");i.innerHTML=`\n          <span>#${s}:</span>\n          <span>${e.score||0}</span>\n      `,n.appendChild(i),s++})),e.docs[9]?e.docs[9].data().score:e.docs[s-2].data().score}const Eh=document.getElementById("title"),Th=document.getElementById("start"),bh=document.getElementById("bg-music"),Ih=new Image;Ih.src="assets/game/UI/hearts.png";const Sh={introBGMusic:"./assets/music/bg/memory.mp3",medBGMusic:"assets/music/bg/TemplePath.mp3",fastBGMusic:"./assets/music/bg/mountainoftrials.mp3",gameOverBGMusic:"./assets/music/bg/churchofsaints.mp3",enemyDestroyAudio:new Audio("./assets/music/effects/destroy2.wav"),gameOverAudio:new Audio("./assets/music/effects/game_over.mp3"),mistakeAudio:new Audio("assets/music/effects/mistake.wav")};Sh.enemyDestroyAudio.volume=.1,Sh.gameOverAudio.volume=.3,Sh.mistakeAudio.volume=.2;const Ah={HEART_SIZE:32,HEART_1_X:0,HEART_2_X:0,HEART_3_X:0,HEART_4_X:0,HEART_5_X:0,HEARTS_Y:0,HEARTS_POS_X:40,HEARTS_POS_Y:27,HEART_CANVAS_SIZE:64};class Ch{constructor(t){this.ctx=t.getContext("2d"),this.dimensions={width:t.width,height:t.height},this.bg=new c(this.ctx,2),this.player=new i(this.dimensions,2),this.enemy=new a(this.dimensions,2),this.enemiesData={enemies:[],enemyWords:[],enemyWordPos:[]},this.maxEnemies=3,this.score=0,this.typed="",this.difficultyChange=!1,this.level={med:!1,hard:!1}}run(){this.running=!1,bh.src=Sh.introBGMusic,this.animate(0,0)}play(){this.running=!0,this.typed="",Eh.innerHTML="",Th.innerHTML="",this.addEnemies()}restart(){this.running=!1,Object.keys(this.enemiesData).forEach((t=>this.enemiesData[t]=[])),this.maxEnemies=4,this.enemy.frameTimer=0,this.typed="",this.score=0,this.player.health=50,this.player.frameTimer=0,Ah.HEART_1_X=0,Ah.HEART_2_X=0,Ah.HEART_3_X=0,Ah.HEART_4_X=0,Ah.HEART_5_X=0,this.player.walk(),this.bg.changeSpeed(.7),this.bg.frameTimer=0,bh.src=Sh.introBGMusic,Object.keys(this.level).forEach((t=>this.level[t]=!1)),Eh.innerHTML="typebit",Th.innerHTML="press any key to start"}gameOver(){return this.player.outOfHealth()}changeDifficulty(){this.score>50?this.maxEnemies=4:this.score>=100&&this.score<=150&&(this.maxEnemies=6),this.score>150&&this.score<=250?(this.maxEnemies=7,this.level.med||(bh.src=Sh.medBGMusic,this.level.med=!0)):this.score>250&&this.score<=350?(this.maxEnemies=8,this.bg.changeSpeed(1.5),this.player.run(),this.level.hard||(bh.src=Sh.fastBGMusic,this.level.hard=!0)):this.score>300&&this.score<=400?this.maxEnemies=10:this.score>400&&(this.bg.changeSpeed(2),this.maxEnemies=12)}removeEnemy(t){const e=this.enemiesData.enemies.indexOf(t);this.enemiesData.enemies.splice(e,1),this.enemiesData.enemyWords.splice(e,1),this.enemiesData.enemyWordPos.splice(e,1)}animate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(t-e)/9500;e=t,this.ctx.clearRect.bind(this,0,0,this.dimensions.width,this.dimensions.height),this.bg.draw(this.ctx,n),this.player.draw(this.ctx,n),this.gameOver()&&this.running&&(bh.src=Sh.gameOverBGMusic,bh.muted||Sh.gameOverAudio.play(),this.health(this.ctx),this.player.dead(),this.bg.changeSpeed(0),Eh.innerHTML="GAME OVER",Th.innerHTML=`final score: ${this.score} <br>[ctrl] to restart`,(async(t,e)=>{try{const t=await vh(Ca(wh,"scores"),{name:"",score:e});console.log("Document written with ID: ",t.id)}catch(t){console.error("Error adding document: ",t)}})(0,this.score),_h(),this.running=!1),this.changeDifficulty(),this.running&&(this.health(this.ctx),this.wordSubmit(),this.enemiesData.enemies.forEach((t=>{t.draw(this.ctx,n),t.bounds().right<0&&(this.removeEnemy(t),this.addEnemies()),this.player.collidesWith(this.player.bounds(),t.bounds())&&!1===t.destroyed&&(this.player.hurt(),this.removeEnemy(t),this.addEnemies())})),this.status(this.ctx)),this.animReq=requestAnimationFrame(this.animate.bind(this))}status(t){t.font="40px VT323",t.fillText(`score: ${this.score}`,960,70),t.font="64px VT323",t.fillText(this.typed,200,280)}addEnemies(){for(;this.enemiesData.enemies.length<this.maxEnemies;){let t=Math.random(),e=Math.random();const n=new a(this.dimensions,t,e,this.enemiesData.enemyWords,this.enemiesData.enemyWordPos,2);this.enemiesData.enemies.push(n),this.enemiesData.enemyWords.push(n.words),this.enemiesData.enemyWordPos.push(n.words_y)}}wordSubmit(){if("~"===this.typed.slice(-1)){if(this.typedWord=this.typed.slice(0,-1),this.enemiesData.enemyWords.includes(this.typedWord)){bh.muted||Sh.enemyDestroyAudio.play();let t=this.enemiesData.enemyWords.indexOf(this.typedWord),e=this.enemiesData.enemies[t];e.destroy(),this.addEnemies(),this.score+=e.score}else bh.muted||Sh.mistakeAudio.play();this.typed=""}}health(t){this.player.health<10&&(Ah.HEART_1_X=64),t.drawImage(Ih,Ah.HEART_1_X,Ah.HEARTS_Y,Ah.HEART_SIZE,Ah.HEART_SIZE,Ah.HEARTS_POS_X,Ah.HEARTS_POS_Y,Ah.HEART_CANVAS_SIZE,Ah.HEART_CANVAS_SIZE),this.player.health<20&&(Ah.HEART_2_X=64),t.drawImage(Ih,Ah.HEART_2_X,Ah.HEARTS_Y,Ah.HEART_SIZE,Ah.HEART_SIZE,Ah.HEARTS_POS_X+Ah.HEART_CANVAS_SIZE,Ah.HEARTS_POS_Y,Ah.HEART_CANVAS_SIZE,Ah.HEART_CANVAS_SIZE),this.player.health<30&&(Ah.HEART_3_X=64),t.drawImage(Ih,Ah.HEART_3_X,Ah.HEARTS_Y,Ah.HEART_SIZE,Ah.HEART_SIZE,Ah.HEARTS_POS_X+2*Ah.HEART_CANVAS_SIZE,Ah.HEARTS_POS_Y,Ah.HEART_CANVAS_SIZE,Ah.HEART_CANVAS_SIZE),this.player.health<40&&(Ah.HEART_4_X=64),t.drawImage(Ih,Ah.HEART_4_X,Ah.HEARTS_Y,Ah.HEART_SIZE,Ah.HEART_SIZE,Ah.HEARTS_POS_X+3*Ah.HEART_CANVAS_SIZE,Ah.HEARTS_POS_Y,Ah.HEART_CANVAS_SIZE,Ah.HEART_CANVAS_SIZE),this.player.health<50&&(Ah.HEART_5_X=64),t.drawImage(Ih,Ah.HEART_5_X,Ah.HEARTS_Y,Ah.HEART_SIZE,Ah.HEART_SIZE,Ah.HEARTS_POS_X+4*Ah.HEART_CANVAS_SIZE,Ah.HEARTS_POS_Y,Ah.HEART_CANVAS_SIZE,Ah.HEART_CANVAS_SIZE)}}const Dh=document.getElementById("canvas"),Rh=document.getElementById("mobile-error"),Nh=document.getElementById("game-container"),kh=document.getElementById("retry"),Mh=document.getElementById("bg-mute"),xh=document.getElementById("bg-music"),Oh=["Tab","CapsLock","Alt","AltGraph","Fn","Super","Symbol","NumLock","Meta","Hyper","Shift","ArrowRight","ArrowLeft","ArrowUp","ArrowDown","Delete","Insert","PageUp","PageDown"];let Lh=!1;const Ph=t=>{t.preventDefault(),xh.muted?(xh.muted=!1,Mh.src="./assets/icons/speaker.png"):(xh.muted=!0,Mh.src="./assets/icons/mute.png")};if(window.mobileCheck=function(){let t=!1;if("maxTouchPoints"in navigator)t=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)t=navigator.msMaxTouchPoints>0;else{const e=matchMedia?.("(pointer:coarse)");if("(pointer:coarse)"===e?.media)t=!!e.matches;else if("orientation"in window)t=!0;else{const e=navigator.userAgent;t=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(e)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(e)}}return t},window.mobileCheck()){Nh.remove(),Rh.textContent="sorry, typebit is not compatible with mobile devices 🥺 \r\n\r\n if you get this error on desktop, try disconnecting touch devices and restart";const t=new Image,e=new Image;t.src="../assets/nav/github.png",e.src="../assets/nav/linkedIn.png",t.onclick=function(){window.location.href="https://github.com/cubeydice/typebit"},e.onclick=function(){window.location.href="hhttps://www.linkedin.com/in/queen-belle-d-118b7859/"};const n=document.createElement("div");Rh.appendChild(n).appendChild(e),Rh.appendChild(n).appendChild(t)}else{const t=new Ch(Dh);t.run(),window.addEventListener("keydown",(function(e){Lh?Oh.includes(e.key)||("Backspace"===e.key?t.typed=t.typed.slice(0,-1):"Escape"===e.key?t.typed="":"Enter"===e.key?t.typed+="~":"Control"===e.key?t.restart():t.typed+=e.key):(t.play(),Lh=!0)}),!1);const e=e=>{e.preventDefault(),Lh=!1,t.restart()};kh.addEventListener("click",e),Mh.addEventListener("click",Ph),_h()}}()}();
//# sourceMappingURL=main.js.map